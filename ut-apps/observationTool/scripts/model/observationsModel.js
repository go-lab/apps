(function(){"use strict";var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;window.ut=window.ut||{},ut.commons=ut.commons||{},ut.tools=ut.tools||{},ut.tools.observationtool=ut.tools.observationtool||{},ut.tools.observationtool.createObservationFromJson=function(t){var e;return e=new ut.tools.observationtool.Observation,e.loadFromJson(t),e},ut.tools.observationtool.Observation=function(){function t(t,e){this.updateId(),this._inquiryPhase=t,this._text=e,this._createdMillis=Date.now(),this._created=new Date(this._createdMillis).toISOString(),this._lastModified=this._created,Object.defineProperties(this,{id:{get:this.getId},inquiryPhase:{get:this.getInquiryPhase},text:{get:this.getText,set:this.setText},createdMillis:{get:this.getCreatedMillis},created:{get:this.getCreated},lastModified:{get:this.getLastModified}})}return t.prototype.getId=function(){return this._id},t.prototype.updateId=function(){return this._id=ut.commons.utils.generateUUID()},t.prototype.getInquiryPhase=function(){return this._inquiryPhase},t.prototype.getText=function(){return this._text},t.prototype.setText=function(t,e){var o;return null==e&&(e=null),o=e?e:(new Date).toISOString(),this._text!==t?(this._text=t,this._lastModified=o):e&&this._lastModified!==o?this._lastModified=o:void 0},t.prototype.getCreatedMillis=function(){return this._createdMillis},t.prototype.getCreated=function(){return this._created},t.prototype.getLastModified=function(){return this._lastModified},t.prototype.getResourceType=function(){return"observation"},t.prototype.getJson=function(){return{id:this.getId(),created:this.getCreated(),lastModified:this.getLastModified(),text:this.getText(),inquiryPhase:this.getInquiryPhase(),metadata:{target:{objectType:"observation"}}}},t.prototype.getResource=function(){return this.getJson()},t.prototype.loadFromJson=function(t){return this._id=t.id,this._created=t.created,this._createdMillis=new Date(this._created).getTime(),this._lastModified=t.lastModified,this._text=t.text,this._inquiryPhase=t.inquiryPhase},t}(),ut.tools.observationtool.ObservationsModel=function(o){function n(e){this.updateResource=t(this.updateResource,this),n.__super__.constructor.call(this,e,"observations"),this.actionLogger=new ut.tools.observationtool.ObservationActionLogger(this.actionLogger),this.myInquiryPhase=this.getStorageHandler().getMetadataHandler().getProvider().inquiryPhaseName,this.myInquiryPhase&&"unknown"===this.myInquiryPhase.toLowerCase()&&(this.myInquiryPhase=null),this._observations=[],this.getStorageHandler().setForAppIdFilter(!1),Object.defineProperties(this,{observations:{get:this.getObservations}})}return e(n,o),n.prototype.createNewModel=function(){return new window.ut.tools.observationtool.ObservationsModel(this.environmentHandlers)},n.prototype.getObservationActionlogger=function(){return this.actionLogger},n.prototype.applyLogAdd=function(t,e){var o,n;switch(o=!1,t.object.objectType){case"observation":n=ut.tools.observationtool.createObservationFromJson(t.object.content),this._observations.push(n);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(!o)return e(null)},n.prototype.applyLogRemove=function(t,e){var o;switch(o=!1,t.object.objectType){case"observation":this.deleteObservation(t.object.id);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(!o)return e(null)},n.prototype.applyLogChange=function(t,e){var o,n;switch(o=!1,t.object.objectType){case"observation":n=this.getObservation(t.object.id),n.setText(t.object.content.text,t.object.content.lastModified);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(!o)return e(null)},n.prototype.isEmpty=function(){return 0===this._observations.length},n.prototype.getObservations=function(){return this._observations},n.prototype.getMyObservations=function(){var t,e,o,n,r;for(n=this._observations,r=[],t=0,e=n.length;t<e;t++)o=n[t],o.inquiryPhase===this.myInquiryPhase&&r.push(o);return r},n.prototype.addNewObservation=function(){var t;return t=new ut.tools.observationtool.Observation(this.myInquiryPhase,""),this._observations.push(t),t},n.prototype.getObservationIndex=function(t){var e,o,n,r,i,s;for(i=-1,o=0,s=this._observations,e=0,n=s.length;e<n;e++)r=s[e],r.id===t?i=o:++o;return i>=0?i:-1},n.prototype.getObservation=function(t){var e;return e=this.getObservationIndex(t),e>=0?this._observations[e]:null},n.prototype.deleteObservation=function(t){var e;return e=this.getObservationIndex(t),e>=0?this._observations.splice(e,1):console.log("cannot delete observation with id "+t+", because it cannot be found")},n.prototype.isSaved=function(){return!0},n.prototype.updateResource=function(t){return this._isSaved?this.getStorageHandler().readResource(this.getId(),function(e){return function(o,r){return o?t(o,r):(e.mergeSavedObservations(r.content),n.__super__.updateResource.call(e,t))}}(this)):this.getStorageHandler().readLatestResource(this.getResourceType(),function(e){return function(o,r){return o?t(o,null):r?(e.mergeSavedObservations(r.content),r.content=e.getResourceContent(),e.loadFromResource(r),n.__super__.updateResource.call(e,t)):e.createResource(t)}}(this))},n.prototype.mergeSavedObservations=function(t){var e,o,n,r,i,s;return s=[],t.observations&&(s=t.observations),i=function(){var t,e,o;for(o=[],t=0,e=s.length;t<e;t++)r=s[t],r.inquiryPhase!==this.myInquiryPhase&&(n=ut.tools.observationtool.createObservationFromJson(r),o.push(n));return o}.call(this),o=this.getMyObservations(),e=i.concat(o),this._observations=e.sort(function(t,e){return t.createdMillis-e.createdMillis})},n.prototype.getResourceContent=function(){var t;return{observations:function(){var e,o,n,r;for(n=this.getObservations(),r=[],e=0,o=n.length;e<o;e++)t=n[e],r.push(t.getJson());return r}.call(this)}},n.prototype.loadFromResourceContent=function(t){var e,o;return this._observations=function(){var n,r,i,s;for(i=t.observations,s=[],n=0,r=i.length;n<r;n++)o=i[n],e=new ut.tools.observationtool.Observation(this.myInquiryPhase,""),e.loadFromJson(o),s.push(e);return s}.call(this)},n.prototype.clearContent=function(){return this._observations=[],n.__super__.clearContent.call(this)},n.prototype.updateIdsInContentAfterImportingResource=function(){var t,e,o,n,r;for(n=this._observations,r=[],t=0,e=n.length;t<e;t++)o=n[t],r.push(o.updateId());return r},n}(ut.commons.ResourceEventEmitterModel),ut.tools.observationtool.MultiObservationsModel=function(o){function n(e,o){this.filterLatestMatadatas=t(this.filterLatestMatadatas,this),n.__super__.constructor.call(this,e,["observations"],o)}return e(n,o),n.prototype.filterLatestMatadatas=function(t){var e,o,n,r,i,s;if(t.length>1){for(o=null,n=0,e=0,r=t.length;e<r;e++)i=t[e],o?(s=new Date(i.published),s>n&&(o=i,n=s)):(o=i,n=new Date(o.published));return[o]}return t},n}(ut.commons.MultiResourceEventEmitterModel)}).call(this);
//# sourceMappingURL=observationsModel.js.map
