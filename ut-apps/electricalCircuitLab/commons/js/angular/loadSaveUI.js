(function(){"use strict";var e,o,t,a,n,s,i,l,r,u,g;window.ut=window.ut||{},ut.commons=ut.commons||{},t=!1,u=!0,g=!1,g&&console.warn("testing page leave!!!"),o=0,e=1e3,l=2e3,i=2e4,t&&(e=5e3,l=1e4,i=2e4),a={ios:!1,safari:!1,applyAlternativeConfiguration:function(){}},r=head.browser.ios||head.browser.safari&&head.mobile,n='<span>\n  <div class="busyWithResources" ng-show="busyWithResources"></div>\n  <ul class="toolbarPart">\n      <li ng-show="showNew">\n          <i class="fa fa-file-o fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: authorConfigurationMode}"\n             ng-click=\'clearResource()\' title="{{::newTooltip}}"></i>\n      </li>\n      <li ng-show="showOpen">\n          <i class="fa fa-folder-open-o fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: authorConfigurationMode}"\n             ng-click=\'openResource()\' title="{{::openTooltip}}"></i>\n      </li>\n      <li ng-show="showExamples">\n          <i class="fa fa-gift fa-fw activeButton fontAweSomeButton"\n             ng-click=\'openExample()\' title="{{::examplesTooltip}}"></i>\n      </li>\n      <li ng-show="showSave">\n          <i class="fa fa-save fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: authorConfigurationMode}"\n             ng-click=\'saveResource()\' title="{{::saveTooltip}}"></i>\n      </li>\n      <li ng-show="showSaveAs">\n          <span class="fontAweSomeStacked fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: authorConfigurationMode}"\n            ng-click=\'saveAsResource()\' title="{{::saveAsTooltip}}">\n              <i class="fa fa-save fontAweSomeUnderStar"></i>\n              <i class="fa fa-star fontAweSomeStack fontAweSomeStackedStar"></i>\n          </span>\n      </li>\n      <li ng-show=\'showImExport\'>\n          <i class="fa fa-upload fa-fw activeButton fontAweSomeButton"\n             ng-click=\'importResource()\' title="{{::importTooltip}}"></i>\n      </li>\n      <li ng-show=\'showImExport\' style="position: relative; top:2px;">\n          <i class="fa fa-download fa-fw activeButton fontAweSomeButton"\n             ng-click=\'exportResource()\' title="{{::exportTooltip}}"></i>\n      </li>\n      <li ng-show="showRefresh">\n          <i class="fa fa-refresh fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: !canRefresh()}"\n             ng-click=\'refreshContent()\' title="{{::refreshTooltip}}"></i>\n      </li>\n      <li ng-show="showClear">\n          <i class="fa fa-eraser fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: !canEraseResetContent()}"\n             ng-click=\'eraseResetContent()\' title="{{::clearTooltip}}"></i>\n      </li>\n      <li ng-show="showDelete">\n          <i class="fa fa-trash-o fa-fw activeButton fontAweSomeButton" ng-class="{disabledButton: cannotDelete}"\n             ng-click=\'deleteResource()\' title="{{::deleteTooltip}}"></i>\n      </li>\n      <li ng-show="showUndoRedo">\n          <i class="fa fa-undo fa-fw activeButton fontAweSomeButton"  ng-class="{disabledButton: !undoRedoManager.canUndo}"\n             ng-click=\'undo()\' title="{{\'loadSave.undo.tooltip\' | g4i18n}}"></i>\n      </li>\n      <li ng-show="showUndoRedo">\n          <i class="fa fa-rotate-right fa-fw activeButton fontAweSomeButton"  ng-class="{disabledButton: !undoRedoManager.canRedo}"\n             ng-click=\'redo()\' title="{{\'loadSave.redo.tooltip\' | g4i18n}}"></i>\n      </li>\n      <li ng-show="showModelJson">\n          <i class="fa fa-book fa-fw activeButton fontAweSomeButton"\n             ng-click=\'showModelJsonDialog()\' title="{{\'loadSave.showModelJson\' | g4i18n}}"></i>\n      </li>\n  </ul>\n  <dialogBox id="{{loadResourceDialogId}}" title="{{loadResourceDialogTitle}}" icon="folder-open-o" resizable="false" width="500"\n             Xheight="400">\n      <resourceSelection resourceType="{{resourceType}}" storageHandler="" g4i18nbasekey="loadSave.loadDialog"></resourceSelection>\n  </dialogBox>\n  <dialogBox id="{{loadExampleDialogId}}" title="{{loadExapleDialogTitle}}" resizable="false" width="500"\n             Xheight="400">\n    <loadExample exampleStoreName="dataStore" dialogId="{{loadExampleDialogId}}"></loadExample>\n  </dialogBox>\n  <dialogBox id="{{saveResourceDialogId}}" title="{{saveResourceDialogTitle}}" resizable="false" width="500">\n      <resourceName resourceType="{{resourceType}}" storageHandler="" g4i18nbasekey="loadSave.loadDialog"></resourceName>\n  </dialogBox>\n  <dialogBox id="{{saveChangesDialogId}}" title="{{saveChangesDialogTitle}}" icon="warning" resizable="false">\n      <askQuestion ok="i_loadSave.saveChangesDialog.save" ok2="i_loadSave.saveChangesDialog.discard" cancel="i_loadSave.saveChangesDialog.cancel"></askQuestion>\n  </dialogBox>\n  <dialogBox id="{{exportResourceDialogId}}" title="{{exportResourceDialogTitle}}" icon="upload" resizable="false" width="500">\n      <askQuestion ok="i_loadSave.saveDialog.download" cancel="i_loadSave.saveDialog.cancel"></askQuestion>\n  </dialogBox>\n  <dialogBox id="{{eraseContentDialogId}}" title="{{eraseContentDialogTitle}}" icon="warning" resizable="false">\n      <askQuestion ok="i_loadSave.eraseContentDialog.erase" cancel="i_loadSave.eraseContentDialog.cancel"></askQuestion>\n  </dialogBox>\n  <dialogBox id="{{eraseResetContentDialogId}}" title="{{eraseResetContentDialogTitle}}" icon="warning" resizable="false">\n      <askQuestion ok="i_loadSave.eraseResetContentDialog.erase"  ok2="i_loadSave.eraseResetContentDialog.reset" cancel="i_loadSave.eraseResetContentDialog.cancel"></askQuestion>\n  </dialogBox>\n  <dialogBox id="{{deleteResourceDialogId}}" title="{{deleteResourceDialogTitle}}" icon="warning" resizable="false">\n      <askQuestion ok="i_loadSave.deleteResourceDialog.delete" cancel="i_loadSave.deleteResourceDialog.cancel"></askQuestion>\n  </dialogBox>\n  <dialogBox id="{{showModelJsonDialogId}}" title="{{showModelJsonDialogTitle}}" icon="book" resizable="false" width="670">\n    <div class="modelJsonDialog">\n      <textarea ng-model="model.json" class="modelJson"></textarea>\n      <div class="dialogButtonRow">\n        <ul class="toolbar">\n          <li>\n             <i class="fa fa-refresh fa-fw activeButton fontAweSomeButton dialogButton" ng-click=\'updateModelJson()\'\n              title="{{\'loadSave.showModelJsonDialog.refresh\' | g4i18n}}"></i>\n          </li>\n          <li>\n             <i class="fa fa-times fa-fw activeButton fontAweSomeButton dialogButton"\n               ng-click=\'closeShowModelJsonDialog()\' title="{{\'loadSave.showModelJsonDialog.close\' | g4i18n}}"></i>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </dialogBox>\n</span>\n',s=function(a,s,d,c,f,m,v,p,h){return{restrict:"E",template:n,replace:!0,scope:!0,link:function(n,d,w){var S,R,D,B,C,M,b,A,x,y,T,k,L,I,E,N,F,J,O,V,q,Q,_,H,z,U,$,j,W,P,X,G,K,Y,Z,ee,oe,te,ae,ne,se,ie,le,re,ue,ge,de,ce,fe,me,ve,pe,he,we;return n.busyWithResources=!1,z=o++,K="loadDialogBox"+z,P="loadExampleBox"+z,le="saveDialogBox"+z,ie="saveChangesBox"+z,O="exportDialogBox"+z,N="eraseContentBox"+z,F="eraseResetContentBox"+z,L="deleteResourceBox"+z,ce="showModelJsonBox"+z,n.loadResourceDialogId=K,n.loadExampleDialogId=P,n.saveResourceDialogId=le,n.saveChangesDialogId=ie,n.exportResourceDialogId=O,n.eraseContentDialogId=N,n.eraseResetContentDialogId=F,n.deleteResourceDialogId=L,n.showModelJsonDialogId=ce,ge=w.modelname,"string"!=typeof ge||""===ge?void console.error("you must define an attribute 'modelName'"):(Y=n[ge])?!Y instanceof window.ut.commons.ResourceEventEmitterModel?void console.error("expected to find a model class object on the scope, named "+ge+", which must be an instance of window.ut.commons.ResourceEventEmitterModel"):(n.dataStore=null,n.dataStoreName="",J=!1,Z="configuration"===Y.getResourceType(),n.authorConfigurationMode=!Z&&c.runningInGraasp,S=ut.commons.utils.getBooleanAttributeValue(w,"save",!0),S&&(n.authorConfigurationMode&&(S=!1),Z&&Y.runningInIls&&(S=!1)),p(function(){var e;if(e=ut.commons.utils.getAttributeValue(w,"dataStoreName",""),e&&n[e])return n.dataStoreName=e,n.dataStore=n[e],J=!0}),fe=null,Z||Y.isChangeTrackingFullyImplemented()&&(fe=new window.ut.commons.UndoRedoManager(Y),n.undoRedoManager=fe),j=function(){return ut.commons.utils.getBooleanAttributeValue(w,"save",!0)&&ut.commons.utils.getBooleanAttributeValue(w,"autoSave",!0)&&c.autoSave},k="loadSaveUI("+Y.getResourceType()+"):",t&&console.log(k+" start: resourceType: "+Y.getResourceType()+", modelIsConfiguration: "+Z+", "+("scope.authorConfigurationMode: "+n.authorConfigurationMode+", allowAutoSaveModel: "+S)),we=function(){var e,o;return o=ut.commons.utils.getBooleanAttributeValue(w,"single",c.getSingleDocumentMode()),e=ut.commons.utils.getBooleanAttributeValue(w,"save",!0),n.showNew=ut.commons.utils.getBooleanAttributeValue(w,"new",!o),n.showNew=ut.commons.utils.getBooleanAttributeValue(w,"new",!1),n.showOpen=ut.commons.utils.getBooleanAttributeValue(w,"open",!o),n.showSave=ut.commons.utils.getBooleanAttributeValue(w,"save",!0)&&!j(),n.showSaveAs=e&&ut.commons.utils.getBooleanAttributeValue(w,"saveAs",!o),n.showImExport=ut.commons.utils.getBooleanAttributeValue(w,"imexport",c.getShowImportExport()),n.showExamples=J&&ut.commons.utils.getBooleanAttributeValue(w,"examples",c.getShowLoadExamples()),n.showRefresh=ut.commons.utils.getBooleanAttributeValue(w,"refresh",!1),n.showClear=e&&ut.commons.utils.getBooleanAttributeValue(w,"clear",!0),n.showDelete=e&&ut.commons.utils.getBooleanAttributeValue(w,"delete",!o),n.showDelete=e&&ut.commons.utils.getBooleanAttributeValue(w,"delete",!1),n.showModelJson=ut.commons.utils.getBooleanAttributeValue(w,"modelJson",c.getShowModelJson()),n.showUndoRedo=fe&&Y.isChangeTrackingFullyImplemented()&&ut.commons.utils.getBooleanAttributeValue(w,"undoRedo",!1),p(ut.commons.utils.gadgetResize)},we(),p(function(){return we(),c.addListeners(["modelChanged","modelLoaded","modelCleared"],function(){return we(),!1})},0),oe=Y.getResourceType(),te=a.getMessage("resources.type.name."+oe),R=Y.getApplication(),D=a.getMessage("tools.name."+R),me=Z?a.getMessage("loadSave.titleConfiguration.unnamed",D):a.getMessage("loadSave.title.unnamed",te),re=a.getMessage("loadSave.notification.saved",te),n.newTooltip=a.getMessage("loadSave.new.tooltip",te),n.openTooltip=a.getMessage("loadSave.open.tooltip",te),n.examplesTooltip=a.getMessage("loadSave.examples.tooltip",te),n.saveTooltip=a.getMessage("loadSave.save.tooltip",te),n.saveAsTooltip=a.getMessage("loadSave.saveAs.tooltip",te),n.importTooltip=a.getMessage("loadSave.import.tooltip",te),n.exportTooltip=a.getMessage("loadSave.export.tooltip",te),n.refreshTooltip=a.getMessage("loadSave.refresh.tooltip",te),n.clearTooltip=a.getMessage("loadSave.clear.tooltip",te),n.deleteTooltip=a.getMessage("loadSave.delete.tooltip",te),n.resourceType=oe,n.loadResourceDialogTitle=a.getMessage("loadSave.loadDialog.dialogTitle",te),n.loadExapleDialogTitle=a.getMessage("loadSave.examplesDialog.dialogTitle",te),n.saveResourceDialogTitle=a.getMessage("loadSave.saveDialog.dialogTitle",te),n.eraseContentDialogTitle=a.getMessage("loadSave.eraseContentDialog.dialogTitle",te),n.exportResourceDialogTitle=a.getMessage("loadSave.saveDialog.dialogTitle",te),n.eraseResetContentDialogTitle=a.getMessage("loadSave.eraseResetContentDialog.dialogTitle",te),n.saveChangesDialogTitle=a.getMessage("loadSave.saveChangesDialog.dialogTitle",te),n.deleteResourceDialogTitle=a.getMessage("loadSave.deleteResourceDialog.dialogTitle",te),n.showModelJsonDialogTitle=a.getMessage("loadSave.showModelJsonDialog.dialogTitle",te),n.showType=ut.commons.utils.getBooleanAttributeValue(w,"showType",!1),n.showAuthor=ut.commons.utils.getBooleanAttributeValue(w,"showAuthor",!1),q=function(){var e;return e=me,Z||c.defaultResourceName&&(e=c.defaultResourceName),e},ue="",B="",Q=function(){return JSON.stringify(Y.getResourceContent())},de=function(){return ue=Q(),B=ue},de(),pe=function(){return n.cannotDelete=!Y.isSaved()||n.authorConfigurationMode},Y.addListeners(["modelLoaded","modelCleared","modelResourceCreated"],function(){return de(),p(function(){return pe()},0)}),pe(),n.isEmpty=function(){return Y.isEmpty()},n.canEraseResetContent=function(){return!!H()||!Y.isEmpty()},n.canRefresh=function(){return Y.canReloadFromStorage()},S&&f.addHandler(function(){var e;if(j()){if(t&&(console.log("userName: "+Y.getStorageHandler().getMetadataHandler().getActor().displayName),console.log(Y.getDebugLabel()+": try to do a final save....")),!ee()&&!g)return console.log("nothing changed");if(console.log(Y.getDebugLabel()+": there are changes..."),Y.isSaved())return e=!0,r&&(e=!1),Y.updateResource(function(){},e),Y.getActionLogger().logSave(Y.getResource(),e),console.log(Y.getDebugLabel()+": saved and logged changes");if(t)return console.warn(k+" cannot do a final save, because the model is not yet saved")}}),V=0,W=0,A=!1,b=!1,T=function(){if(V=0,W=0,A=!1,de(),t)return console.log(Y.getDebugLabel()+".clearChangedMillis()")},he=function(){if(W=Date.now(),0===V)return V=W},Y.addListeners(["modelResourceCreated","modelResourceUpdated"],T),Y.addListener("modelChanged",function(){if(W=Date.now(),0===V&&(V=W),t)return console.log(Y.getDebugLabel()+".model changed")}),Y.addListeners(["modelLoaded","modelCleared"],function(){return T(),B=Q()}),M=function(){var e,o,a,n;if(B||(B=Q()),e=function(){var e,o;return e=Y.isChanged(),e||Y.isChangeTrackingFullyImplemented()||(o=Q(),o!==B&&(A=!0,he(),B=o),e=A),t&&console.log(Y.getDebugLabel()+".isModelChanged: modelChanged: "+e+", model.isChanged(): "+Y.isChanged()),e},j()&&!b){if(n=e(),n&&(a=Date.now()-W,o=Date.now()-V,t&&console.log("millisSinceLastChange: "+a+", millisSinceFirstChange: "+o),a>l||o>i))return C()}else if(t)return console.log(Y.getDebugLabel()+".autoSaveCheck() isAutoSave(): "+j()+", autoSaveInProgress: "+b)},C=function(e){var o,a,s,i;if(null==e&&(e=!1),null!=n.golab&&!n.golab.startupFinished)return void console.warn("Skipping auto-save because startup is not finished, yet.");if(i=function(){var e,o;return e=Date.now()-Y._firstChangeMillis,o=Date.now()-Y._lastChangeMillis,console.log(Y.getDebugLabel()+".autoSaveAction: millis since changes: first: "+e+", last: "+o)},s=!0,e||ee()||(T(),s=!1,Y.clearChanged()),s){if(b=!0,t&&console.log(Y.getDebugLabel()+".autoSaveAction() trying to do an auto save"),o=function(){return b=!1,T()},Y.isSaved())return t&&i(),Y.updateResource(se(!1,o));if(a=q())return Y.setDisplayName(a),Y.isReadOnly()&&Y.setMetadataFlag("readOnly",!1),Y.createResource(se(!0,o))}},g||S&&h(M,e),ee=function(){var e;return e=Q(),e!==ue},x=function(e){return n.showSave&&ee()?(j()&&(Y.isSaved()||c.singleDocumentMode&&c.defaultResourceName)?(C(),e()):n.askQuestion.questionParams={question:a.getMessage("loadSave.saveChangesDialog.question",te),answer:null,dialogBoxId:ie,questionOkAnswer:function(){return ae(e)},questionOk2Answer:function(){return e()},questionCancelAnswer:function(){}},n.dialogBoxes[ie].show()):e()},G=function(e){var o,t;try{return t=JSON.parse(JSON.stringify(e)),Y.loadFromResource(t),de()}catch(t){return o=t,v.reportError(a.getMessage("loadSave.failure.load",o),"Failed to load resource from: "+JSON.stringify(e),o)}},U=function(e,o){var t;try{return Y.importFromFile(e,o),de()}catch(o){return t=o,v.reportError(a.getMessage("loadSave.failure.import",t),"Failed to import content from file: "+e.name,t)}},n.openResource=function(){if(n.showOpen&&!n.authorConfigurationMode)return t&&console.log(k+" openResource"),x(function(){return n.storageHandler=Y.getStorageHandler(),n.dialogBoxes[K].show(),n.loadResource=function(e){return t&&console.log(e),n.dialogBoxes[K].close(),G(e),Y.setSaved(!0),Y.getActionLogger().logLoad(e)},n.cancel=function(){return n.dialogBoxes[K].close()}})},n.examples={selectedCategory:"",selectedData:""},n.getDatas=function(){return n.dataStore?n.dataStore.getDatas(n.examples.selectedCategory):[]},n.openExample=function(){if(n.showExamples)return t&&console.log(k+" openExample"),x(function(){return n.dialogBoxes[P].show(),n.loadExampleResource=function(e){return G(e),Y.setSaved(!1),j()&&C(!0),Y.getActionLogger().logLoad(e)}})},n.importResource=function(){if(n.showImExport)return t&&console.log(k+" importResource"),p(function(){return x(function(){return s.getTextFromDialog(function(e,o,t){return e?v.reportError(a.getMessage("loadSave.failure.import",e),"Failed to import resource",e):n.$apply(function(){return U(o,t),Y.setSaved(!1)})})})})},n.refreshContent=function(){if(n.canRefresh())return t&&console.log(k+" refreshContent"),Y.reloadFromStorage(function(e){return e&&v.reportError(a.getMessage("loadSave.failure.refresh",e),"Failed to refresh resource",e),n.$apply()})},I=!1,$=function(){var e;if(n.authorConfigurationMode)return e=q(),void Y.setDisplayName(e);if(S)return j()?(t&&console.log(Y.getDebugLabel()+": initialSaveAction"),Y.isSaved()?(t&&console.log(Y.getDebugLabel()+": initialSaveAction: model is a saved model"),de()):Y.getStorageHandler().listResourceMetaDatas(function(o,n){var s,i,l,r,u,g;if(o)return v.reportError(a.getMessage("loadSave.failure.listMetadata",o),"Failed to get list of metaDatas",o);for(i={},l=0,u=n.length;l<u;l++)g=n[l],i[g.metadata.target.displayName]=g;for(r=q(),s=0,e=r;i[e];)++s,e=r+" "+s;return Y.setDisplayName(e),Y.isReadOnly()&&Y.setMetadataFlag("readOnly",!1),Y.createResource(se(!0,de)),I=!0,t?console.log(Y.getDebugLabel()+": initialSaveAction: model is saved as "+e):void 0})):(Y.isSaved()||(e=q(),Y.setDisplayName(e),t&&console.log(Y.getDebugLabel()+": initialSaveAction: model renamed to "+e)),de())},X=function(){var e;if(!Z&&c.loadInitialResource&&c.initialResourceString)return e=JSON.parse(c.initialResourceString),Y.loadContentFromResource(e.content)},y=function(e){return Y.setDisplayName(q()),Y.setSaved(!1),Y.clear(),X(),e&&e(),$()},n.clearResource=function(){if(n.showNew&&!n.authorConfigurationMode)return t&&console.log(k+" clearResource"),x(function(){return y(function(){var e;return e={objectType:Y.getResourceType(),content:Y.getResourceTarget()},Y.getActionLogger().logClear(e)})})},H=function(){return c.loadInitialResource&&c.initialResourceString&&c.initialResourceString.length>0},n.eraseResetContent=function(){var e,o,s;if(n.showClear&&n.canEraseResetContent())return t&&console.log(k+" eraseResetContent"),H()?(s=a.getMessage("loadSave.eraseResetContentDialog.question",te),e=F):(s=a.getMessage("loadSave.eraseContentDialog.question",te),e=N),o=function(e){var o;return Y.clearContent(),o={objectType:Y.getResourceType(),content:Y.getResourceTarget()},e&&(X(),o.content.initialContent=Y.getResourceContent()),Y.getActionLogger().logClear(o)},n.askQuestion.questionParams={question:s,answer:null,dialogBoxId:e,questionOkAnswer:function(){return o(!1)},questionOk2Answer:function(){return o(!0)},questionCancelAnswer:function(){}},n.dialogBoxes[e].show()},ae=function(e){var o;return Y.isSaved()?(o=se(!1,e),Y.updateResource(o)):ne(e)},ne=function(e,o){return n.storageHandler=Y.getStorageHandler(),n.resource={name:o?o:Y.getDisplayName()},n.dialogBoxes[le].show(),n.busyWithResources=!1,n.saveAs=function(o,a){return t&&console.log("do saveAs, resourceName: "+o+", resourceMetadata: "+a),n.dialogBoxes[le].close(),Y.setDisplayName(o),a||I?(Y.updateResource(se(!1,e)),I=!1):(Y.isReadOnly()&&Y.setMetadataFlag("readOnly",!1),Y.createResource(se(!0,e)))},n.cancel=function(){return n.dialogBoxes[le].close()}},se=function(e,o){return function(t,s){var i,l;return t?(i="update",l="loadSave.failure.save",e&&(i="create",l="loadSave.failure.saveAs"),v.reportError(a.getMessage(l,t),"Failed to "+i+" resource: "+JSON.stringify(Y.getResourceDescription()),t)):(Y.setSaved(!0),de(),e?Y.getActionLogger().logSaveAs(s):Y.getActionLogger().logSave(s),o&&o(),u&&!j()&&m.success(re)),p(function(){return n.busyWithResources=!1})}},n.saveResource=function(){var e;if(n.showSave&&!n.authorConfigurationMode)return t&&console.log(k+" saveResource, saved: "+Y.isSaved()),n.busyWithResources=!0,Y.isSaved()&&!Y.isReadOnly()?(e=se(!1),Y.updateResource(e)):(Y.isReadOnly()&&Y.setMetadataFlag("readOnly",!1),Z?Y.createResource(se(!0)):ne())},n.saveAsResource=function(){if(n.showSaveAs&&!n.authorConfigurationMode)return t&&console.log(k+" saveAsResource"),n.busyWithResources=!0,ne()},n.exportResource=function(){if(n.showImExport)return t&&console.log(k+" exportResource"),n.askQuestion.questionParams={question:"",answer:Y.getDisplayName(),dialogBoxId:O,questionOkAnswer:function(e){var o;return Y.setDisplayName(e),o=Y.getResourceBundle(),s.storeAsFile(o,e+".json"),Y.emitModelLoaded(),de(),Y.getActionLogger().logSaveAs(o)}},n.dialogBoxes[O].show()},n.deleteResource=function(){if(n.showDelete&&!n.cannotDelete)return t&&console.log(k+" deleteResource"),Y.isSaved()?(n.askQuestion.questionParams={question:a.getMessage("loadSave.deleteResourceDialog.question",te),dialogBoxId:L,questionOkAnswer:function(){var e;return n.busyWithResources=!0,e=Y.getResource(),Y.deleteResource(function(o){var t;return o?v.reportError(a.getMessage("loadSave.failure.delete",o),"Failed to delete resource: "+JSON.stringify(Y.getResourceDescription()),o):(t=e.metadata,y(function(){return Y.getActionLogger().logDelete({metadata:t})})),n.busyWithResources=!1})}},n.dialogBoxes[L].show()):void 0},E=function(e){var o,t;if(fe){if(e){if(!fe.getCanUndo())return;fe.undo(),t="undo"}else{if(!fe.getCanRedo())return;fe.redo(),t="redo"}return o={objectType:t,id:Y.getId(),content:Y.getResource()},Y.getActionLogger().logChange(o)}},n.undo=function(){return E(!0)},n.redo=function(){return E(!1)},n.showModelJsonDialog=function(){return n.updateModelJson(),n.dialogBoxes[ce].show()},n.closeShowModelJsonDialog=function(){return n.dialogBoxes[ce].close()},n.model={json:""},n.updateModelJson=function(){var e;return e=Y.getResource(),n.model.json=JSON.stringify(e,null,"  ")},_=function(){var e,o,s,i,l;if(!Z)return l=null,e=function(){if(l)return c.setInitialResourceString(l)},i=function(){return Y.initialLoadingFinished(),n.golab&&(n.golab.startupFinished=!0),$()},o=function(){var e;return t&&console.log(k+" loadDefaultConfiguration"),e=!1,n.applyAlternativeConfiguration&&(e=n.applyAlternativeConfiguration(Y)),e||c.loadDefaultConfiguration(),c.setMetadataFlag("readOnly",!0),c.setSaved(!1),c.getActionLogger().logLoad(c.getResource())},s=function(){var e,o;return c.loadInitialResource&&c.initialResourceString&&(e=JSON.parse(c.initialResourceString),"undefined"!=typeof e.metadata&&null!==e.metadata||(e.metadata={}),"undefined"!=typeof e.metadata.flags&&null!==e.metadata.flags||(e.metadata.flags={}),e.metadata.flags.readOnly=!0,Y.importFromResource(e),o=q(),o&&Y.setDisplayName(o),Y.getActionLogger().logLoad(e)),i()},c.getAutoLoadLatestResource()?c.loadLatestResource(function(r,u){return r&&v.reportError(a.getMessage("loadSave.failure.loadLatestConfiguration",r),"Failed to load latest configuration resource: "+JSON.stringify(c.getResourceDescription()),r),r||u?c.getActionLogger().logLoad(c.getResource()):o(),u&&u.content&&u.content.initialResourceString&&(l=u.content.initialResourceString),c.startupFinished=!0,e(),c.getAutoLoadLatestResource()&&!n.authorConfigurationMode?Y.loadLatestResource(function(e,o){return e&&v.reportError(a.getMessage("loadSave.failure.loadLatest",e),"Failed to load latest resource: "+JSON.stringify(Y.getResourceDescription()),e),o?(t&&console.log("model: latest resource loaded"),Y.getActionLogger().logLoad(Y.getResource()),i()):(s(),t&&console.log("model: no latest resource")),n.$apply()}):(s(),n.$apply())}):(o(),c.startupFinished=!0,s())},Z?ve=n.$watch("configurationModel.startupFinished",function(e){if(e)return ve(),$()}):Y.mainModelClass?(Y!==c&&c.setApplicationModel(Y),Y.startupFinished?_():(console.log("setup $watch for "+ge+".startupFinished"),ve=n.$watch(ge+".startupFinished",function(e){if(console.log("$watch("+ge+".startupFinished): "+e),e)return ve(),_()}))):void 0):void console.error("expected to find a model class object on the scope, named "+ge)}}},ut.commons.golabUtils.directive("loadSave".toLowerCase(),["languageHandler","fileStorage","localStorageService","configurationModel","leavePageDetector","Notification","errorHandler","$timeout","$interval",s])}).call(this);
//# sourceMappingURL=loadSaveUI.js.map
