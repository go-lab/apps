(function(){"use strict";var e,n,t,o,a,r,i,l,s,c,u;this.golab=this.golab||{},this.golab.common=this.golab.common||{},this.golab.ils=this.golab.ils||{},c=this.golab.ils,c.context=this.golab.ils.context||{},c.storage=this.golab.ils.storage||{},this.ude=this.ude||{},this.ude.commons=this.ude.commons||{},e=window.$,l={storage:{},options:{cache:!0,notificationServer:{}},when:{}},n="http://golab.collide.info:80",i=!1,s=!1,t=!1,r=function(e,o,a,r,l){var u,g,d,w,f,m,h,p,v,b,y,H,S,x;return"function"==typeof r&&(l=r,r={}),x=null,S=null,p=function(e){var n,t,o,a,r,i,l;if(e=e.toLowerCase(),o=null,l=location.search.trim().toLowerCase(),l&&"?"===l[0])for(i=l.substring(1).split("&"),n=0,t=i.length;n<t;n++)a=i[n],r=a.split("="),2===r.length&&r[0]===e&&(o=r[1]);return o},d=function(e){var n;return s?"local":(n=p("storageServer"),n&&(n=function(){switch(n.toLowerCase()){case"local":case"tomtest":case"vault":case"mongo":case"localmongo":case"memory":return n.toLowerCase();default:return console.warn("unknown storageServer parameter: "+n),null}}()),n||(n=function(){switch(e.getContext()){case c.context.standalone:return"mongo";case c.context.ils:case c.context.graasp:return"vault";case c.context.preview:return"memory";default:return"local"}}()),n)},g=function(e){var n;if(s||null===r.notificationServer)return null;if(n=p("notificationServer"),"null"===n)return null;if(null!==n)return n;switch(e.getContext()){case c.context.preview:case c.context.unknown:return null;default:return r.notificationServer}},m=function(e){var n,t;if(null==e)throw new Error("MetadataHandler is needed to create a StorageHandler, but parameter was undefined.");switch(n=d(e),t=function(){switch(n){case"local":return new c.storage.LocalStorageHandler(e);case"tomtest":return new c.storage.MongoStorageHandler(e,"http://tomtest.gw.utwente.nl:8080");case"localmongo":return new c.storage.MongoStorageHandler(e,"http://localhost:8000");case"vault":return new c.storage.VaultStorageHandler(e);case"mongo":return new c.storage.MongoIISStorageHandler(e,window.location.protocol+"//go-lab.gw.utwente.nl/mongoStorage/iis_scripts");case"memory":return new c.storage.MemoryStorageHandler(e);default:return console.warn("Unknown storage server: "+n),new c.storage.LocalStorageHandler(e)}}(),e.getContext()){case c.context.preview:case c.context.direct:case c.context.unknown:t.setForUserFilter(!1),t.setForAppIdFilter(!1),t.setForProviderFilter(!1)}return[t,n]},f=function(e){var n;return null==e?(console.warn("No metadataHandler was given to find the loggingTarget, use 'null' as default."),"null"):(n=p("loggingTarget"),n||(n=function(){switch(e.getContext()){case c.context.standalone:return"consoleShort";case c.context.ils:case c.context.graasp:return"openSocial";default:return"null"}}()),n)},h=function(e){var t,o,a;return o=window.ude.commons.NotificationClient.bind(null,e),t=window.ude.commons.DisabledNotificationClient,a=g(e),null===a?t("Intentionally disabled via query parameters (eg. 'notificationServer=null') or configuration."):(void 0===a&&(a=n),"https:"===window.location.protocol&&0===a.indexOf("https:")?t("Preventing mixed content issues since we are running in https environment but requesting http server url ("+a+")."):o(a))},v=function(e){var n;if(n=p("cache"))switch(n.toLocaleLowerCase()){case"true":case"on":return!0;case"false":case"off":return!1}if(r.cache===!1)return!1;switch(e){case"local":case"tomtest":case"vault":case"mongo":return!0;default:return!1}},w=function(e,n){switch(n.getContext()){case window.golab.ils.context.ils:return!1;default:return!0}},u=function(){var e,n,a,r,s,c;if(x&&S)return i&&console.log("configuring environment handlers for context: "+x.getContext()),r=h(x),e=new window.ut.commons.actionlogging.ActionLogger(x),e.setLoggingTarget(f(x)),c=null,a=null,s=m(x),c=s[0],a=s[1],v(a,x)?(n=w(a,x),n&&!t&&(window.golab.ils.storage.clearCachingStorageHandlerCache(),t=!0),window.golab.ils.storage.createCachingStorageHandler(c,!0,function(n,t){return n?(console.warn("Something went wrong during the creation of a cache for the storageHandler, no cache wil be used"),console.warn(n),l(x,c,e,S,r)):l(x,t,e,S,r)},o)):l(x,c,e,S,r)},H=function(e,n){return e?console.error("failed to create metadataHandler: "+e):(x=n,u())},b=function(e,n){return e?(console.error("failed to create languageHandler: "+e),S="none",u()):(S=n,u())},y={id:"",published:"",actor:{objectType:"person",id:"unknown",displayName:"unknown"},target:{objectType:e,id:ut.commons.utils.generateUUID(),displayName:"unnamed "+e},generator:{objectType:"application",url:window.location.href,id:ut.commons.utils.generateUUID(),displayName:o},provider:{objectType:"ils",url:window.location.href,id:"unknown",inquiryPhase:"unknown",inquiryPhaseId:"unknown",inquiryPhaseName:"unknown",displayName:"unknown"}},null!=window.gadgets?new c.metadata.GoLabMetadataHandler(y,H):new c.metadata.LocalMetadataHandler(y,H),window.golab.createLanguageHandler(a,b)},u=function(e,n){var t,o,a,r,i,l,s;for(i=e.languageHandler,s=[],r=0,l=n.length;r<l;r++)o=n[r],a=i.getMessage("resources.type.name."+o),t=e.languageHandler.getMessage("loadSave.title.unnamed",a),s.push(e[o].metadataHandler.setTargetDisplayName(t));return s},a=function(n,t,o,a,i){var l,s,c,g,d,w;if(0===n.length)throw"documentTypes array may not be empty";for(g={toolName:t},l=function(n){return function(n){var i;return i=new e.Deferred,r(n,t,o,a,function(e,t,o,a,r){var l;return l={metadataHandler:e,storageHandler:t,actionLogger:o},g[n]=l,g.languageHandler||(g.languageHandler=a),g.notificationClient||(g.notificationClient=r),i.resolve()}),i.promise()}}(this),s=[],d=0,w=n.length;d<w;d++)c=n[d],s.push(l(c));return e.when.apply(e,s).done(function(){return u(g,n),console.log("createMultipleEnvironmentHandlers (desired language: "+o+", using: "+g.languageHandler.getLanguage()+"):"),console.log(g),i(g)})},o=function(e,n,t,o,i){return"function"==typeof o&&(i=o,o={}),"undefined"==typeof o.notificationServer&&(o.notificationServer=null),Array.isArray(e)?a(e,n,t,o,i):r(e,n,t,o,i)},this.golab.common.createEnvironmentHandlers=o}).call(this);
//# sourceMappingURL=createEnvironmentHandlers.js.map
