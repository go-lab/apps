(function(){"use strict";var t,e,n,r=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;window.ut=window.ut||{},ut.commons=ut.commons||{},e=!1,n=25,t=function(){function t(t){this._json=t.getResourceContent(),this._jsonString=JSON.stringify(this._json),t.isContentCopy()||(this._json=JSON.parse(this._jsonString))}return t.prototype.equals=function(t){return this._jsonString===t._jsonString},t.prototype.apply=function(t){return e&&console.log("applying model state "+this),t.loadContentFromResource(this._json)},t.prototype.toString=function(){return this._jsonString},t}(),window.ut.commons.UndoRedoManager=function(i){function s(t){if(this.model=t,this.printState=r(this.printState,this),this._modelChanged=r(this._modelChanged,this),this._resetStateArray=r(this._resetStateArray,this),this._resetStateArray(),!this.model instanceof window.ut.commons.ResourceEventEmitterModel)throw new Error("the model must be an instance of window.ut.commons.ResourceEventEmitterModel");this._listeningToEvents=!0,this.model.addListener("modelChanged",function(t){return function(e){if(t._listeningToEvents)return t._modelChanged(e)}}(this)),this.model.addListeners(["modelLoaded","modelCleared"],function(t){return function(){if(t._listeningToEvents)return t._resetStateArray()}}(this)),Object.defineProperties(this,{canUndo:{get:this.getCanUndo},canRedo:{get:this.getCanRedo}})}return o(s,i),s.prototype._getModelState=function(){return new t(this.model)},s.prototype._applyModelState=function(t){return this._listeningToEvents=!1,t.apply(this.model),this._listeningToEvents=!0},s.prototype._resetStateArray=function(){return e&&console.log("reset states"),this._stateArray=[],this._currentStateIndex=-1,this._addState(this._getModelState())},s.prototype._addState=function(t){if(this._stateArray.length>=n&&this._stateArray.splice(0,1),this._currentStateIndex=this._stateArray.length,this._stateArray[this._currentStateIndex]=t,e&&console.log("added state: "+t._jsonString),e)return this.printState()},s.prototype._modelChanged=function(t){var n,r;if(!t||t.bigChange!==!1)return n=this._getModelState(),e&&console.log("_modelChanged(modelState)"),!this._stateArray[this._currentStateIndex].equals(n)&&(r=this._currentStateIndex+1,this._stateArray.length>r&&this._addState(this._stateArray[this._currentStateIndex]),this._addState(n),e)?this.printState():void 0},s.prototype.printState=function(){var t,e,n,r,o,i;for(console.log("@_currentStateIndex: "+this._currentStateIndex+", nrOfStates: "+this._stateArray.length),e=0,o=this._stateArray,n=0,r=o.length;n<r;n++)i=o[n],t=e===this._currentStateIndex?"*":" ",console.log(""+t+e+": "+i),e++;return console.log()},s.prototype.getCanUndo=function(){return this._currentStateIndex>0},s.prototype.getCanRedo=function(){return this._currentStateIndex+1<this._stateArray.length},s.prototype.undo=function(){var t;if(this.canUndo&&(this._currentStateIndex--,t=this._stateArray[this._currentStateIndex],this._applyModelState(t),e))return this.printState()},s.prototype.redo=function(){var t;if(this.canRedo&&(this._currentStateIndex++,t=this._stateArray[this._currentStateIndex],this._applyModelState(t),e))return this.printState()},s}(window.EventEmitter)}).call(this);
//# sourceMappingURL=undoRedoManager.js.map
