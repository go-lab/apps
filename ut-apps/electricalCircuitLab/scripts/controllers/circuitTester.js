(function(){"use strict";var t;window.ut=window.ut||{},ut.simulations=ut.simulations||{},ut.simulations.electricity=ut.simulations.electricity||{},ut.simulations.electricity.circuitboard=ut.simulations.electricity.circuitboard||{},t=function(t,e,n,o){var i,r,c;return r=new ut.simulations.electricity.CircuitSimulator(o,(!0),(!0)),t.circuitBoardOptions={},t.config=t.config||{},t.config.showDebugOut=!1,i=function(){var e,n,i,c,s,u,a,l;for(t.circuitBoardOptions.xSize=o.getMaxComponentXPos(),t.circuitBoardOptions.ySize=o.getMaxComponentYPos(),t.nonWireComponents=function(){var t,e,i,r;for(i=o.getComponents(),r=[],t=0,e=i.length;t<e;t++)n=i[t],n.isWire()||r.push(n);return r}(),o.removeAllSensors(),r.circuitChanged(!0),c=r.connectionPoints,l=0,s=0,u=c.length;s<u;s++)i=c[s],a=new ut.simulations.electricity.SensorModel("circuitTester",0,(l++)),a.place({cmpId1:i.getComponent1().getPositionId(),cmpId2:i.getComponent2().getPositionId()}),a.displayId=i.getId(),o.addSensor(a);return r.sensorsChanged(),e=function(){var e,s,u,a,l,g,p,d,m,f,h,y,C,I,w,P,D,S,v,R,k,N,L,O,T,b,M,V,x;for(x=[],N=0,O=c.length;N<O;N++)i=c[N],C=r.getConnectionPointState(i),y={cmpId1:i.getComponent1().getPositionId(),cmpId2:i.getComponent2().getPositionId(),voltage:C.voltage,current:C.current},x.push(y);for(t.stateJson=JSON.stringify(x),w=function(t){var e;switch(e=t.getJson(),e.type){case"dcVoltageSource":e.voltage=t.getTheVoltage()}return e.id=t.getDisplayId(),e},d=function(){var t,e,i,r;for(i=o.getComponents(),r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(w(n));return r}(),I=new ut.simulations.electricity.CreateBiDirectionalGraph(o.getComponents()),b=[],M={},e=function(t){if(t.isNone()&&!M[t.getId()])return b.push(w(t)),M[t.getId()]=!0},V=I.connectionPoints,L=0,T=V.length;L<T;L++)i=V[L],e(i.getComponent1()),e(i.getComponent2());return P=function(t){return{id:t.getId(),componentType:t.getComponentType(),x:t.getXPos(),y:t.getYPos()}},D=function(t){return{id:t.getId(),component1:t.getComponent1().getDisplayId(),component2:t.getComponent2().getDisplayId(),direction1:t.getDirection1(),direction2:t.getDirection2(),artificial:t.isArtificial()}},h=function(){var t,e,n,o;for(n=I.connectionPoints,o=[],t=0,e=n.length;t<e;t++)i=n[t],o.push(D(i));return o}(),f=function(){var t,e,n,o;for(n=I.connectionLinks.asArray(),o=[],t=0,e=n.length;t<e;t++)m=n[t],o.push({id:m.id,component:m.component.getDisplayId(),from:m.fromNode.getId(),to:m.toNode.getId()});return o}(),a=ut.simulations.electricity.splitBiDirectionalGraph(I.connectionPoints,I.connectionLinks,o.getComponents()),u=function(){var t,e,n;for(n=[],t=0,e=a.length;t<e;t++)s=a[t],n.push({components:s.components.map(function(t){return t.getDisplayId()}),connectionPoints:s.connectionPoints.map(function(t){return t.getId()}),connectionLinks:s.connectionLinks.asArray().map(function(t){return t.id})});return n}(),v=!1,R=null,g=function(){var t,e,n;for(n=[],t=0,e=a.length;t<e;t++)s=a[t],S=new ut.simulations.electricity.CreateGraph(s.connectionPoints,s.connectionLinks,s.components),l={state:S.circuitResult.state,error:S.circuitResult.error,graph:null,nrOfPowerSupplies:S.circuitResult.nrOfPowerSupplies},S.circuitResult.error&&(v=!0,R=S.circuitResult.state),k=function(t){return t.map(function(t){return m=t.getConnectionLink(),{id:t.id,fromNode:t.fromNode.getId(),toNode:t.toNode.getId(),connectionLink:m?m.id:null,deadEnd:t.endsDead()}})},S.circuitResult.graph&&(l.graph={beginNode:S.circuitResult.graph.beginNode.getId(),endNode:S.circuitResult.graph.endNode.getId(),resultType:S.circuitResult.graph.resultType,graphLinks:k(S.circuitResult.graph.graphLinks),nextGraphLinks:k(S.circuitResult.graph.nextGraphLinks)}),n.push(l);return n}(),!R&&r.errorMessage&&(R=r.errorMessage),p={components:d,nonComponents:b,connectionPoints:h,connectionLinks:f,biDirectionalGraphResults:u,circuitResults:g},v||R||(p.connectionPointStates=x),R&&(p.expectedError=R),t.circuitTestData=JSON.stringify(p)},t.config.calculateTestData?e():t.circuitTestData=""},c=function(){var t,e,i,r,c;for(o.setDcVoltageSource(null),r=n.getPowerSupplies(),c=[],t=0,e=r.length;t<e;t++)switch(i=r[t],i.getType()){case"dcVoltageSource":i.setValue(10),i.setState(!0),c.push(o.setDcVoltageSource(i));break;default:c.push(console.log("unknown type of power supply: "+i))}return c},c(),t.circuitModel=o,t.postionComponents=!0,t.postionSensors=!0,t.nonWireComponents=[],t.stateJson="",t.$watch("circuitModel.modelCounter",function(){return i()}),t.calculate=function(){return i()},t.$watch("config.showDebugOut",function(){return ut.simulations.electricity.debugModelCalculations=t.config.showDebugOut}),t.getComponentValue=function(t){return t.isResistor()?t.getResistance():t.isPowerSupply()?t.getTheVoltage():0}},ut.simulations.electricity.circuitsimulator.controller("circuitTesterCtrl",["$scope","meterDAO","powerDAO","circuitModel",t])}).call(this);
//# sourceMappingURL=circuitTester.js.map
