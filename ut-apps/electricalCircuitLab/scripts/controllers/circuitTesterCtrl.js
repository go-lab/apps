var ut;!function(n){var e;!function(e){var o;!function(e){"use strict";function o(n,o,i,c){var r=n,u=new e.CircuitSimulator(c,(!0),(!0));r.circuitBoardOptions={},r.config=r.config||{},r.config.showDebugOut=!1,r.config.acMode=!1,r.config.polar=!1,r.config.nrOfDigitsOptions=[3,4,5,6,7,8,9,10],r.config.nrOfDigits=3;var a=0,s=function(){var n=function(){return c.powerSource?[{id:c.powerSource.getId(),voltage:{value:c.powerSource.voltage.getValue().value},frequency:{value:c.powerSource.frequency.getValue().value}}]:[]},o=function(n){var e=n.getJson();switch(e.type){case"dcVoltageSource":e.voltage=n.getTheVoltage()}return e.id=n.getDisplayId(),e},i=function(n){return n.map(function(n){return o(n)})},a=new e.CreateBiDirectionalGraph(c.getComponents()),s=new e.DirectedGraphInformation(c.getComponents(),a.connectionPoints,a.connectionLinks),l=new t,p=function(n){n.isNone()&&(l.containsKey(n.getId())||l.put(n.getId(),n))};a.connectionPoints.forEach(function(n){p(n.getComponent1()),p(n.getComponent2())});var g=function(n){return{id:n.getId(),component1:n.getComponent1().getDisplayId(),component2:n.getComponent2().getDisplayId(),direction1:n.getDirection1(),direction2:n.getDirection2(),artificial:n.isArtificial()}},d=function(n){return{id:n.getId(),component:n.getComponent().getDisplayId(),from:n.fromNode.getId(),to:n.toNode.getId()}},f=a.connectionPoints.map(function(n){return g(n)}),m=a.connectionLinks.asArray().map(function(n){return d(n)});e.createComponentSideConnectionPointsMap(s);var C=function(n){return n.map(function(n){return n.getId()})},P=function(n){return n.map(function(n){return n.getId()})},I=function(n){return n.map(function(n){return n.getId()})},S=function(n){return{connectionPointId:n.connectionPoint.getId(),connectionLinkId:n.connectionLink.getId(),connectedConnectionPointIds:P(n.connectedConnectionPoints),connectedComponentIds:C(n.connectedComponents)}},w=s.componentSideConnectionPointsMap.values().map(function(n){return{componentId:n.component.getId(),side1:S(n.side1),side2:S(n.side2),shortCircuit:n.shortCircuit}}),M=e.splitBiDirectionalGraph(a.connectionPoints,a.connectionLinks,c.getComponents()),h=M.map(function(n){return{components:C(n.components),connectionPoints:P(n.connectionPoints),connectionLinks:I(n.connectionLinks.asArray())}}),v=function(n){var e=u.getConnectionPointState(n);return{cmpId1:n.getComponent1().getPositionId(),cmpId2:n.getComponent2().getPositionId(),acVoltage:{re:e.acVoltage.real,im:e.acVoltage.imaginary},acCurrent:{re:e.acCurrent.real,im:e.acCurrent.imaginary}}},D={acMode:r.configurationModel.acMode,powerSupplies:n(),components:i(c.getComponents()),nonComponents:i(l.values()),connectionPoints:f,connectionLinks:m,componentSideConnectionPointsResults:w,biDirectionalGraphResults:h},y=!1,O=null,V=!1;if(M.forEach(function(n){var o=new e.CreateGraph(n.connectionPoints,n.connectionLinks,n.components);o.circuitResult.error&&("shortCircuit"===o.circuitResult.state&&o.circuitResult.isOhmMeterCircuit?V=!0:y=!0,O=o.circuitResult.state)}),!O&&u.errorMessage&&(O=u.errorMessage),!y){var R=function(n){if(n instanceof e.ParallelComponent){var o=n,t=o.parallelComponentSequences.map(function(n){return b(n)});return o instanceof e.ParallelBatteries?{baseComponentType:"parallelBattery",parallelComponentResults:t}:{baseComponentType:"parallelComponent",parallelComponentResults:t}}return{baseComponentType:"realComponent",realComponentId:n.getId()}},T=function(n){return{connectionPointId:n.connectionPointId,currentRecipe:n.currentRecipe.toString()}},k=function(n){return{incomingConnectionPointIds:P(n.incomingConnectionPoints),outgoingConnectionPointIds:P(n.outgoingConnectionPoints),currentRecipeForConnectionPointResults:n.currentRecipeForConnectionPoints.map(function(n){return T(n)}),deadEndComponentSequencesResults:n.deadEndComponentSequences.map(function(n){return b(n)})}},b=function(n){return{baseComponents:n.components.map(function(n){return R(n)}),componentConnections:n.componentConnections.map(function(n){return k(n)})}},L=function(n){return n?n.getId():null},q=function(n,e){return{componentId:n,inConnectionPointId:e.in.getId(),outConnectionPointId:e.out.getId(),allInConnectionPointIds:P(e.allIn),allOutConnectionPointIds:P(e.allOut),inConnectionLinkId:L(e.inConnectionLink),outConnectionLinkId:L(e.outConnectionLink)}},B=function(n){var e={state:n.state,error:n.error,nrOfPowerSupplies:n.nrOfPowerSupplies,isOhmMeterCircuit:n.isOhmMeterCircuit};return n.componentSequence&&(e.componentSequenceResult=b(n.componentSequence)),n.componentConnectionPointMap&&(e.componentConnectionPointResults=n.componentConnectionPointMap.keys().map(function(e){return q(e.getId(),n.componentConnectionPointMap.get(e))})),e};D.circuitResults=u.getCircuits().map(function(n){return n.circuitResult}).map(function(n){return B(n)}),D.connectionPointStates=a.connectionPoints.map(function(n){return v(n)})}return!V&&O&&(D.expectedError=O),D},l=function(){r.config.calculateTestData?r.circuitTestData=s():r.circuitTestData=""},p=function(){var n=new e.PowerModel("dcVoltageSource0","power",r.configurationModel.acMode);return n.voltage.setFormattedValue(10),n.frequency.setFormattedValue(1e3),n},g=function(){r.circuitBoardOptions.xSize=c.getMaxComponentXPos(),r.circuitBoardOptions.ySize=c.getMaxComponentYPos(),r.nonWireComponents=c.getComponents().filter(function(n){return!n.isWire()}),c.removeAllSensors(),u.acMode=r.configurationModel.acMode,null===c.powerSource&&c.setPowerSource(p()),a=u.acMode?2*Math.PI*c.powerSource.frequency.getValue().value:0,u.circuitChanged();var n=u.connectionPoints;n.forEach(function(n,o){var t=new e.SensorModel("circuitTester",0,o,"",(!1));t.place({cmpId1:n.getComponent1().getPositionId(),cmpId2:n.getComponent2().getPositionId()}),t.setDisplayId(n.getId()),c.addSensor(t)}),u.sensorsChanged(),l()};r.toggleUpdateTestData=function(){r.config.calculateTestData=!r.config.calculateTestData},r.toggleShowDebugOut=function(){r.config.showDebugOut=!r.config.showDebugOut},r.toggleAcMode=function(){r.configurationModel.acMode=!r.configurationModel.acMode,r.calculate()},r.togglePolar=function(){r.config.polar=!r.config.polar},n.$watch("config.calculateTestData",function(){l()});var d=function(){c.setPowerSource(null),i.getPowerSupplies().forEach(function(n){switch(n.getType()){case"dcVoltageSource":var e=n;e.voltage.setFormattedValue(10),e.frequency.setFormattedValue(1e3),c.setPowerSource(e);break;default:console.log("unknown type of power supply: "+n)}})};d(),r.circuitModel=c,r.postionComponents=!0,r.postionSensors=!0,r.nonWireComponents=[],r.stateJson="",n.$watch("circuitModel.modelCounter",g),r.calculate=function(){g()},n.$watch("config.showDebugOut",function(){e.debugModelCalculations=r.config.showDebugOut}),r.getComponentValue=function(n){return n.hasImpedance()?n.getImpedance(a).toExtendedString(r.config.nrOfDigits):n.isBattery()?n.getTheVoltage().toPrecision(r.config.nrOfDigits)+" V":n.isDcVoltageSource()?r.configurationModel.acMode?n.getTheVoltage(c.powerSource).toPrecision(r.config.nrOfDigits)+" V, "+(c.powerSource.frequency.getValue().value.toPrecision(r.config.nrOfDigits)+" Hz"):n.getTheVoltage().toPrecision(r.config.nrOfDigits)+" V":""}}var t=n.commons.tsutils.Map;e.circuitsimulator.controller("circuitTesterCtrl",["$scope","meterDAO","powerDAO","circuitModel",o])}(o=e.electricity||(e.electricity={}))}(e=n.simulations||(n.simulations={}))}(ut||(ut={}));
//# sourceMappingURL=circuitTesterCtrl.js.map
