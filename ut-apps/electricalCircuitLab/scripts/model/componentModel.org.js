(function(){"use strict";var t,i=function(t,i){function o(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return o.prototype=i.prototype,t.prototype=new o,t.__super__=i.prototype,t},e={}.hasOwnProperty,o=function(t,i){return function(){return t.apply(i,arguments)}},n=[].indexOf||function(t){for(var i=0,e=this.length;i<e;i++)if(i in this&&this[i]===t)return i;return-1};window.ut=window.ut||{},ut.simulations=ut.simulations||{},ut.simulations.electricity=ut.simulations.electricity||{},ut.simulations.electricity.directions=["north","east","south","west"],ut.simulations.electricity.definitions={wire:{image:"wire",connections:["north","south"],deltaVolt:!1,resistance:!1,wire:!0,dcCompatible:!0,acCompatible:!0},corner:{image:"corner",connections:["east","south"],deltaVolt:!1,resistance:!1,wire:!0,dcCompatible:!0,acCompatible:!0},split:{image:"split",connections:["north","east","south"],deltaVolt:!1,resistance:!1,wire:!0,dcCompatible:!0,acCompatible:!0},cross:{image:"cross",connections:["north","east","south","west"],deltaVolt:!1,resistance:!1,wire:!0,dcCompatible:!0,acCompatible:!0},resistor:{image:"resistor",connections:["east","west"],deltaVolt:!1,resistance:!0,wire:!1,dcCompatible:!0,acCompatible:!0},capacitor:{image:"capacitor",connections:["east","west"],deltaVolt:!1,resistance:!0,wire:!1,dcCompatible:!1,acCompatible:!0},coil:{image:"coil",connections:["east","west"],deltaVolt:!1,resistance:!0,wire:!1,dcCompatible:!1,acCompatible:!0},dcVoltageSource:{image:"dcVoltageSource",connections:["west","east"],deltaVolt:!0,resistance:!1,wire:!1,dcCompatible:!0,acCompatible:!1},acVoltageSource:{image:"acVoltageSource",connections:["west","east"],deltaVolt:!0,resistance:!1,wire:!1,dcCompatible:!1,acCompatible:!0},dcCurrentSource:{image:"dcCurrentSource",connections:["west","east"],deltaVolt:!0,resistance:!1,wire:!1,dcCompatible:!0,acCompatible:!1},battery1_5V:{image:"battery1_5V",connections:["north","south"],deltaVolt:!0,resistance:!1,wire:!1,fixedVoltage:1.5,dcCompatible:!0,acCompatible:!1},battery6V:{image:"battery6V",connections:["north","south"],deltaVolt:!0,resistance:!1,wire:!1,fixedVoltage:6,dcCompatible:!0,acCompatible:!1},battery9V:{image:"battery9V",connections:["north","south"],deltaVolt:!0,resistance:!1,wire:!1,fixedVoltage:9,dcCompatible:!0,acCompatible:!1},battery12V:{image:"battery12V",connections:["north","south"],deltaVolt:!0,resistance:!1,wire:!1,fixedVoltage:12,dcCompatible:!0,acCompatible:!1},ohmMeterSource:{image:"ohmMeterSource",connections:["west","east"],deltaVolt:!0,resistance:!1,wire:!1,fixedVoltage:1,dcCompatible:!0,acCompatible:!1},switch2On:{image:"switch2On",connections:["north","south"],deltaVolt:!1,resistance:!1,switchesTo:"switch2Off",wire:!0,switch:!0,dcCompatible:!0,acCompatible:!0},switch2Off:{image:"switch2Off",connections:[],deltaVolt:!1,resistance:!1,switchesTo:"switch2On",wire:!1,switch:!0,dcCompatible:!0,acCompatible:!0},switch2Left:{image:"switch2Left",connections:["west","south"],deltaVolt:!1,resistance:!1,switchesTo:"switch2Right",wire:!0,switch:!0,dcCompatible:!0,acCompatible:!0},switch2Right:{image:"switch2Right",connections:["east","south"],deltaVolt:!1,resistance:!1,switchesTo:"switch2Left",wire:!0,switch:!0,dcCompatible:!0,acCompatible:!0},light:{image:"light",connections:["east","west"],deltaVolt:!1,resistance:!0,wire:!1,dcCompatible:!0,acCompatible:!0},lightBroken:{image:"lightBroken",connections:[],deltaVolt:!1,resistance:!1,wire:!1,dcCompatible:!0,acCompatible:!0}},t={json:null},ut.simulations.electricity.ValueDefinition=function(){function t(t){this.json=t,this.defined=!1,this.initialValue=0,this.adjustable=!1,this.minimumValue=0,this.maximumValue=0,this.valueStep=0,this.init()}return t.prototype.init=function(){return"number"==typeof this.json?(this.adjustable=!1,this.initialValue=this.json,this.defined=!0):"object"==typeof this.json?(this.adjustable=!0,this.initialValue=this.json.value,this.minimumValue=this.json.minimum,this.maximumValue=this.json.maximum,this.valueStep=this.json.step,this.defined=!0):void 0},t.prototype.isDefined=function(){return this.defined},t.prototype.isAdjustable=function(){return this.adjustable},t.prototype.getValue=function(){return"number"==typeof this.initialValue?this.initialValue:this.initialValue.value},t.prototype.setValue=function(t){return this.initialValue=t},t.prototype.getMinimumValue=function(){return this.minimumValue},t.prototype.getMaximumValue=function(){return this.maximumValue},t.prototype.getValueStep=function(){return this.valueStep},t.prototype.getJson=function(){return this.adjustable?{value:this.initialValue,minimum:this.minimumValue,maximum:this.maximumValue,step:this.valueStep}:this.initialValue},t}(),ut.simulations.electricity.ResistorDataSourceColumn=function(t){function e(t){this.resistor=t,e.__super__.constructor.call(this)}return i(e,t),e.prototype.getImageInformation=function(){return{type:"commonImage",value:this.resistor.definition.image+".png"}},e.prototype.getId=function(){return this.resistor.getId()},e.prototype.getType=function(){return"number"},e.prototype.getLabel=function(){return"R "+this.resistor.getPositionLabel()},e.prototype.getUnit=function(){return"Î©"},e.prototype.getValue=function(){return this.resistor.getResistance()},e}(ut.commons.DataSourceColumn),t={lightComponent:null},ut.simulations.electricity.LightDisplayModel=function(t){function e(t){this.lightComponent=t,this.overloadAction=o(this.overloadAction,this),e.__super__.constructor.call(this,this.lightComponent.getId(),0,0,"light",!0),this.updatePosition(),this.lightIntensity=0,this.overload=0,this.startOverloadTime=0,this.maxOverload=2e3,this.overloadTimeStep=50,this.overloadTimer=null,this.broken=!1}return i(e,t),e.prototype.updatePosition=function(){var t,i,e,o,n,s;switch(e=this.lightComponent.getLocation(),t=e.left+"_"+e.top,n=e.left,s=e.top,this.lightComponent.getRotate()){case 0:++n;break;case 90:++s;break;case 180:--n;break;case 270:--s}return i=n+"_"+s,o={cmpId1:t,cmpId2:i},this.place(o)},e.prototype.sensorStateChanged=function(){var t,i,e,o,n;if(!this.broken)return t=this.getCurrentValue(),n=this.lightComponent.getResistance(),e=this.lightComponent.getTheVoltage(),o=e*e/n,i=t*t*n,this.lightIntensity=i/o*100,this.checkForOverloadAction()},e.prototype.checkForOverloadAction=function(){if(!this.broken&&this.lightIntensity>100&&null===this.overloadTimer&&this.lightComponent.allowBurnThroughLight())return this.overloadAction()},e.prototype.overloadAction=function(){var t,i,e;return i=this.lightIntensity-100,i>0&&this.lightComponent.allowBurnThroughLight()?(this.startOverloadTime&&(t=i*i*(Date.now()-this.startOverloadTime)/1e3,this.overload+=t),this.overload>this.maxOverload?(this.broken=!0,this.lightIntensity=300,null!=(e=this.lightComponent)&&e.componentChangedReporter(),setTimeout(function(t){return function(){var i;return t.lightIntensity=0,t.lightComponent.switch("lightBroken"),null!=(i=t.lightComponent)?i.componentChangedReporter():void 0}}(this),this.overloadTimeStep)):(this.startOverloadTime=Date.now(),this.overloadTimer=setTimeout(this.overloadAction,this.overloadTimeStep))):(this.overloadTimer=null,this.startOverloadTime=0)},e}(ut.simulations.electricity.SensorModel),t={componentConfiguration:null},ut.simulations.electricity.ComponentModel=function(){function t(t,e){var o,n;if(this.componentConfiguration=t,null==e&&(e=!1),this.definitionType=this.componentConfiguration.type,this.definition=ut.simulations.electricity.definitions[this.definitionType],"undefined"==typeof this.definition)throw new Error("trying to use unknown component definitionType: "+JSON.stringify(componentConfiguration));this.xPos=this.componentConfiguration.x,this.yPos=this.componentConfiguration.y,this.rotation=this.componentConfiguration.rotate,this.color=this.componentConfiguration.color,this.voltageDefinition=null,this.resistanceDefinition=null,this.id=!e&&this.componentConfiguration.id?(o=this.componentConfiguration.id.split("_"),o.length>0?(n=parseInt(o[1]),i<n?i=n:void 0):void 0,this.componentConfiguration.id):"cmp_"+ ++i,this.sensor=null,this.dataSourceColumn=null,this.init(),this.placeCounter=0,this.selected=!1,this.componentChangedReporter=null,this.allowBurnThroughLightFunction=null}var i;return i=0,t.prototype.toString=function(){return"ComponentModel{id="+this.id+",type="+this.definitionType+",voltage="+this.getTheVoltage()+",resistance="+this.getResistance+"}"},t.prototype.getDefaultValueJson=function(t,i){return"undefined"==typeof t?i:t},t.prototype.init=function(){var t;switch((this.isPowerSupply()||this.isLight())&&(t=this.isBattery()?this.definition.fixedVoltage:this.getDefaultValueJson(this.componentConfiguration.voltage,10),this.voltageDefinition=new ut.simulations.electricity.ValueDefinition(t),this.setVoltage(this.voltageDefinition.getValue())),this.hasImpedance()&&(this.resistanceDefinition=new ut.simulations.electricity.ValueDefinition(this.getDefaultValueJson(this.componentConfiguration.resistance,100)),this.setResistance(this.resistanceDefinition.getValue())),"light"===this.definitionType&&(this.sensor=new ut.simulations.electricity.LightDisplayModel(this)),this.definitionType){case"resistor":return this.dataSourceColumn=new ut.simulations.electricity.ResistorDataSourceColumn(this)}},t.prototype.getDataSourceColumn=function(){return this.dataSourceColumn,null},t.prototype.getSensor=function(){return this.sensor},t.prototype.getCanSwitch=function(){return!!this.definition.switchesTo},t.prototype.switch=function(t){return this.definitionType=t?t:this.definition.switchesTo,this.definition=ut.simulations.electricity.definitions[this.definitionType]},t.prototype.setComponentChangedReporter=function(t){return this.componentChangedReporter=t},t.prototype.setAllowBurnThroughLightFunction=function(t){return this.allowBurnThroughLightFunction=t},t.prototype.allowBurnThroughLight=function(){return!this.allowBurnThroughLightFunction||this.allowBurnThroughLightFunction(this)},t.prototype.getJson=function(){var t;return t={type:this.definitionType,x:this.xPos,y:this.yPos,rotate:this.rotation,id:this.id},(this.isResistor()||this.isLight())&&(t.resistance=this.resistanceDefinition.getJson()),(this.isPowerSupply()||this.isLight()||this.isOmhMeterSource())&&(t.voltage=this.isBattery()||this.isLight()||this.isOmhMeterSource()?this.voltageDefinition.getJson():0),this.color&&(t.color=this.color),t},t.prototype.getId=function(){return this.id},t.prototype.getPositionId=function(){return this.xPos+"_"+this.yPos},t.prototype.getPositionLabel=function(){return this.xPos+"-"+this.yPos},t.prototype.getDisplayId=function(){return this.xPos+"_"+this.yPos+"_"+this.definitionType},t.prototype.getComponentType=function(){return this.definitionType},t.prototype.isNone=function(){return!1},t.prototype.isWire=function(){return this.definition.wire},t.prototype.isSwitch=function(){return this.definition.switch===!0},t.prototype.isPowerSupply=function(){return this.isDcVoltageSource()||this.isBattery()||this.isOmhMeterSource()||this.isAcVoltageSource()},t.prototype.isDcVoltageSource=function(){return"dcVoltageSource"===this.definitionType},t.prototype.isAcVoltageSource=function(){return"acVoltageSource"===this.definitionType},t.prototype.isBattery=function(){return!(!this.definition.fixedVoltage||this.isOmhMeterSource())},t.prototype.isOmhMeterSource=function(){return"ohmMeterSource"===this.definitionType},t.prototype.isNonPowerSupplyComponent=function(){return this.isResistor()||this.isLight()||this.isCapacitor()||this.isCoil()},t.prototype.isResistor=function(){return"resistor"===this.definitionType},t.prototype.isCapacitor=function(){return"capacitor"===this.definitionType},t.prototype.isCoil=function(){return"coil"===this.definitionType},t.prototype.isLight=function(){return"light"===this.definitionType||"lightBroken"===this.definitionType},t.prototype.hasImpedance=function(){switch(this.definitionType){case"resistor":case"light":case"capacitor":case"coil":return!0;default:return!1}},t.prototype.isPowerSupplyMinus=function(t){var i;return i=this.getRotatedDirection(t,!1),this.isDcVoltageSource()||this.isOmhMeterSource()||this.isAcVoltageSource()?"west"===i:this.isBattery()?"south"===i:(console.log("unexpected isPowerSupplyMinus call type "+this.definitionType),!1)},t.prototype.getColor=function(){return this.color},t.prototype.getVoltage=function(t){var i;if(!this.isPowerSupply())return 0;if(i=this.getRotatedDirection(t,!1),this.isDcVoltageSource()||this.isOmhMeterSource()||this.isAcVoltageSource())switch(i){case"west":return this.getTheVoltage();case"east":return-this.getTheVoltage();default:return 0}else{if(!this.isBattery())return console.log("unexpected getVoltage call type "+this.definitionType),0;switch(i){case"north":return-this.getTheVoltage();case"south":return+this.getTheVoltage();default:return 0}}},t.prototype.getTheVoltage=function(){return this.voltageDefinition?this.voltageDefinition.getValue():0},t.prototype.getResistance=function(){return this.resistanceDefinition?this.resistanceDefinition.getValue():0},t.prototype.setVoltage=function(t){if(this.voltageDefinition)return this.voltageDefinition.setValue(t)},t.prototype.setResistance=function(t){if(this.resistanceDefinition)return this.resistanceDefinition.setValue(t)},t.prototype.setLocation=function(t){return this.xPos=t.left,this.yPos=t.top,this.updateLocation(),this.updateSensor()},t.prototype.updateLocation=function(){return++this.placeCounter},t.prototype.updateSensor=function(){var t;return null!=(t=this.sensor)?t.updatePosition():void 0},t.prototype.getLocation=function(){return{left:this.xPos,top:this.yPos}},t.prototype.getXPos=function(){return this.xPos},t.prototype.getYPos=function(){return this.yPos},t.prototype.rotate90=function(){return this.rotation+=90,this.rotation>270&&(this.rotation=0),this.updateSensor()},t.prototype.rotate_90=function(){return this.rotation-=90,this.rotation<0&&(this.rotation=270),this.updateSensor()},t.prototype.setRotate=function(t){switch(t){case 0:case 90:case 180:case 270:return this.rotation=t,this.updateSensor();default:return console.log("illegal angle: "+t)}},t.prototype.getRotate=function(){return this.rotation},t.prototype.hasConnection=function(t){var i;return i=this.getRotatedDirection(t,!1),n.call(this.definition.connections,i)>=0},t.prototype.getConnections=function(t){var i,e,o,n,s,r,a;if(o=this.getRotatedDirection(t,!1),e=[],this.definition.connections.indexOf(o)>=0)for(r=this.definition.connections,n=0,s=r.length;n<s;n++)a=r[n],a!==o&&(i=new ut.simulations.electricity.Connection(this,t,this.getRotatedDirection(a,!0)),e.push(i));return e},t.prototype.getDefinedNrOfConnections=function(){return this.definition.connections.length},t.prototype.getRotatedDirection=function(t,i){var e,o;switch(o=ut.simulations.electricity.directions.indexOf(t),o<0&&console.log("unknown direction: "+t),e=0,this.rotation){case 0:e=0;break;case 90:e=1;break;case 180:e=2;break;case 270:e=3;break;default:console.log("illegal rotation: "+this.rotation)}return i?o+=e:o-=e,o+=ut.simulations.electricity.directions.length,ut.simulations.electricity.directions[o%ut.simulations.electricity.directions.length]},t}(),t={from:null,to:null},ut.simulations.electricity.Connection=function(){function t(t,i,e){this.component=t,this.from=i,this.to=e}return t.prototype.getComponentId=function(){return this.component.getComponentId()},t.prototype.getComponent=function(){return this.component},t.prototype.getFrom=function(){return this.from},t.prototype.getTo=function(){return this.to},t.prototype.getVoltage=function(){return this.component.getVoltage()},t.prototype.getResistance=function(){return this.component.getResistance()},t.prototype.toString=function(){return"Connection, component: "+this.component.getId()+", from "+this.from+" to "+this.to},t.prototype.same=function(t){return this.getComponentId()===t.getComponentId()&&(this.getFrom()===t.getFrom()&&this.getTo()===t.getTo()||this.getFrom()===t.getTo()&&this.getTo()===t.getFrom())},t}()}).call(this);
//# sourceMappingURL=componentModel.org.js.map
