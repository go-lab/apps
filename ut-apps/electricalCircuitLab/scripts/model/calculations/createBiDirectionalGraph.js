(function(){"use strict";var t;window.ut=window.ut||{},ut.simulations=ut.simulations||{},ut.simulations.electricity=ut.simulations.electricity||{},ut.simulations.electricity.debugModelCalculations=!1,t={positionId:""},ut.simulations.electricity.nonComponentType="NONE",ut.simulations.electricity.NonComponent=function(){function t(t,n){this.xPos=t,this.yPos=n,this.positionId=this.xPos+"_"+this.yPos,this.id=this.xPos+"_"+this.yPos+"_NONE"}return t.prototype.getXPos=function(){return this.xPos},t.prototype.getYPos=function(){return this.yPos},t.prototype.getId=function(){return this.id},t.prototype.getPositionId=function(){return this.positionId},t.prototype.getDisplayId=function(){return this.id},t.prototype.getComponentType=function(){return ut.simulations.electricity.nonComponentType},t.prototype.isNone=function(){return!0},t.prototype.getConnections=function(){return[]},t.prototype.isOmhMeterSource=function(){return!1},t.prototype.getJson=function(){return{type:this.getComponentType(),x:this.xPos,y:this.yPos,rotate:0,id:this.id}},t}(),t={connectionPoints:null,connectionLinks:null,circuitResult:null,nrOfPowerSupplies:0},ut.simulations.electricity.CreateBiDirectionalGraph=function(){function t(t){this.debug=ut.simulations.electricity.debugModelCalculations,this.components=t,this.connectionPoints=[],this.connectionLinks=new ut.simulations.electricity.LinkArray,this.createConnectionGraph(),this.debug&&(this.printComponents(),this.printConnectionPoints())}return t.prototype.createConnectionGraph=function(){var t,n,o,e,i,s,r,c,u,l,a,p,h,f,g;e=this.connectionPoints,n=this.components,o=this.connectionLinks,p=[],u=function(t,n,o,i){var s,r,c,u;for(r=0,c=e.length;r<c;r++)if(s=e[r],s.isValidFor(t,o))return s;return u=new ut.simulations.electricity.ConnectionPoint(t,n,o,i),e.push(u),u},r=function(t,o){var e,i;for(i in n)if(e=n[i],e.getXPos()===t&&e.getYPos()===o)return e;return l(t,o)},l=function(t,n){var o,e,i;for(e in p)if(o=p[e],o.getXPos()===t&&o.getYPos()===n)return o;return i=new ut.simulations.electricity.NonComponent(t,n),p.push(i),i},c=function(t,n){var o,e;switch(o=t.getXPos(),e=t.getYPos(),n){case"north":e+=-1;break;case"east":o+=1;break;case"south":e+=1;break;case"west":o+=-1}return r(o,e)},g=function(t){switch(t){case"north":return"south";case"east":return"west";case"south":return"north";case"west":return"east"}},s=function(t,n){var e,i,s,r,l,a;if(a=t.getConnections(n),0!==a.length)return i=c(t,n),i?(r=g(n),s=i.getConnections(r),l=u(t,n,i,r),e=function(n){var e,i,s;return i=c(n.getComponent(),n.getTo()),s=u(t,n.getTo(),i,g(n.getTo())),e=new ut.simulations.electricity.ConnectionLink(l,s,n.getComponent()),o.addLink(e)},a.forEach(e)):void 0},i=function(){var t,n,e,i,s,r,c,u;for(s=o.asArray(),u=[],r=0,c=s.length;r<c;r++)switch(i=s[r],n=function(){var t,n,s,r;for(s=o.asArray(),r=[],t=0,n=s.length;t<n;t++)e=s[t],e.fromNode===i.toNode&&e.toNode===i.fromNode&&r.push(e);return r}(),n.length){case 0:t=new ut.simulations.electricity.ConnectionLink(i.toNode,i.fromNode,i.getComponent()),u.push(o.addLink(t));break;case 1:break;default:u.push(console.log("unexpected number ("+n.length+") of back links for "+i))}return u},f=function(){var t,i,s,r,c;c=function(t,n){var i,s,r,c,u,l,a,p,h,f,g;for(r=[],l=0,p=n.length;l<p;l++)c=n[l],r.push(c.fromNode),o.removeLink(c);for(i=new ut.simulations.electricity.ConnectionPoint(t,"center",t,"center",(!0)),e.push(i),f=[],a=0,h=r.length;a<h;a++)s=r[a],g=new ut.simulations.electricity.ConnectionLink(i,s,t),o.addLink(g),u=new ut.simulations.electricity.ConnectionLink(s,i,t),f.push(o.addLink(u));return f},r=[];for(s in n)switch(t=n[s],t.getComponentType()){case"split":case"cross":i=o.getFilteredLinks(function(n){return n.component===t}),i.length>2?r.push(c(t,i)):r.push(void 0);break;default:r.push(void 0)}return r},h=this.components;for(a in h)t=h[a],s(t,"north"),s(t,"east"),s(t,"south"),s(t,"west");return i(),f()},t.prototype.getConnectionPoint=function(t,n){var o,e,i,s,r,c,u,l;for(c=this.connectionPoints,e=0,i=c.length;e<i;e++)if(o=c[e],s=null!=(u=o.getComponent1())?u.getPositionId():void 0,r=null!=(l=o.getComponent2())?l.getPositionId():void 0,s===t&&r===n||s===n&&r===t)return o;return null},t.prototype.printComponents=function(){var t,n,o,e,i;console.log("All components:"),o=0,e=this.components,i=[];for(n in e)t=e[n],console.log(" "+o+": "+t.getDisplayId()),i.push(++o);return i},t.prototype.printConnectionPoints=function(){var t,n,o,e,i,s,r,c,u,l,a;for(console.log("ConnectionLinks:\n"+this.connectionLinks.getAllLinksAsString(" ")),console.log("ConnectionPoints:"),e=0,u=this.connectionPoints,a=[],o=0,r=u.length;o<r;o++){for(n=u[o],console.log(" "+e+": "+n),i=0,l=this.connectionLinks.getFromLinks(n),s=0,c=l.length;s<c;s++)t=l[s],console.log("  "+i+": to "+t.toNode),++i;a.push(++e)}return a},t}()}).call(this);
//# sourceMappingURL=createBiDirectionalGraph.js.map
