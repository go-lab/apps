(function(){"use strict";window.ut=window.ut||{},ut.simulations=ut.simulations||{},ut.simulations.electricity=ut.simulations.electricity||{},ut.simulations.electricity.printGraphResults=function(e,r,t){var n,o,i,a;return n=function(e){var r;return e?(r=t?t(e):"",e+"("+r+","+("#deadGRes="+e.getDeadGraphResults().length+",#deadGNod="+e.getDeadGraphNodes().length+")")):"NONE"},a=new ut.simulations.electricity.NodeTracker,o=function(e,r){var t;if(t=e.getDeadGraphResults(),t.length)return a.isNodeVisited(e)?console.log(r+"dead end graph results already shown"):(a.nodeVisited(e),console.log(r+"dead end graph results"),i(t,r+"  "))},i=function(e,r){return e.forEach(function(e,t){var a,u;if(e.graphLinks.length>0)return u=" ",console.log(r+u+t+": resultType="+e.resultType+", endNode="+n(e.endNode)+", nr of nextGraphLinks "+e.nextGraphLinks.length),a=0,u+=" ",console.log(r+u+a+": "+n(e.graphLinks[0].fromNode)),e.graphLinks.forEach(function(e){if(a++,console.log(r+u+a+": "+n(e.toNode)),o(e.toNode,r+u+"  "),e instanceof ut.simulations.electricity.BranchedGraphLink)return i(e.branchGraphs,r+u+"  ")})})},console.log("Graph results for "+e+":"),i(r,"")},ut.simulations.electricity.CreateDirectedGraph=function(){function e(e,r,t,n){var o,i,a,u,s,l,d,h,c;this.debug=ut.simulations.electricity.debugModelCalculations,o=function(e,r,t){var n,i,a,u,s,l,d;for(a=t,d=[];a<r.length;){if(i=r[a],i instanceof ut.simulations.electricity.BranchedGraphLink)for(l=i.branchGraphs,u=0,s=l.length;u<s;u++)n=l[u],o(e,n.graphLinks,0);else e.addDeadGraphNode(i.toNode);d.push(++a)}return d},i=function(e){var r,t,n,i,a,u;return u=function(e,r,t){var n,i,a,u,s;for(a=r,n=0,i=!1;a<e.length&&n<t.length&&!i;)s=e[a].toNode,u=t[n].toNode,s.equals(u)?(a++,n++):i=!0;if(i)return o(e[a].fromNode,t,n)},r=function(e,r,t){var n,i,a,u,s;for(a=r,n=0,i=!1;a>=0&&n<t.length&&!i;)s=e[a].fromNode,u=t[n].toNode,s.equals(u)?(a--,n++):i=!0;if(i)return o(e[a].toNode,t,n)},i=function(e,t,n){return n[0].toNode.equals(e[t].toNode)?u(e,t,n):t>0&&n[0].toNode.equals(e[t-1].fromNode)?r(e,t,n):0===t&&n[0].toNode.equals(e[e.length-1].fromNode)?r(e,e.length-1,n):o(e[t].fromNode,n,0)},n=function(e,r){var t,n,o,a,u,s;for(n=e[r].fromNode,u=n.getDeadGraphResults(),s=[],o=0,a=u.length;o<a;o++)t=u[o],s.push(i(e,r,t.graphLinks));return s},t=function(e){var r,t,n,o,i;for(o=e.branchGraphs,i=[],t=0,n=o.length;t<n;t++)r=o[t],i.push(a(r.graphLinks));return i},(a=function(e){var r,o;for(r=0,o=[];r<e.length;)e[r]instanceof ut.simulations.electricity.BranchedGraphLink?t(e[r]):n(e,r),o.push(++r);return o})(e.graphLinks)},l=function(e,r){var t;return t=function(e){var r,t,n;for(t=0,n=e.length;t<n;t++)if(r=e[t],"deadEnd"!==r.resultType)return!1;return!0},0===e.foundGraphs.length&&0===r.foundGraphs.length&&t(e.wiredGraphs)&&t(r.wiredGraphs)},a=function(e,r){var t,i,a,u,s,l,d,h;for(d=e.wiredGraphs,a=0,s=d.length;a<s;a++)i=d[a],o(n.toNode,i.graphLinks,1);for(h=r.wiredGraphs,u=0,l=h.length;u<l;u++)t=h[u],o(n.fromNode,t.graphLinks,0);return new ut.simulations.electricity.CreateGraphResult("deadEnd",n.fromNode,n.toNode,[n],[])},d=function(e,r,n){var o,i,a,u,s,l;for(o=function(){var n,o,i,a,u;for(o=t.getFromLinks(e.getConnectionPoint()),u=null,i=0,a=o.length;i<a;i++)n=o[i],n.toNode!==r&&(u=n.toNode);return u},s=o(),u=n.wiredGraphs,i=0,a=u.length;i<a;i++)if(l=u[i],"deadEnd"===l.resultType&&l.graphLinks.length>1&&l.endNode.equals(s))return!0;return!1},u=function(e,r,n){var o,i,u,s,c,f;if(i=new ut.simulations.electricity.GraphBuilder(t,e,r,n,"forward builder"),o=new ut.simulations.electricity.GraphBuilder(t,r,e,[],"backward builder"),i.setOtherGraphBuilder(o),d(e,r,i))return new ut.simulations.electricity.CreateGraphResult("shortCircuit",e,r,[],[]);for(o.setOtherGraphBuilder(i),u=function(){return i.wiredGraphs.length+o.wiredGraphs.length},s=0,f=!0;s<10&&f&&u()>0;)++s,f=i.doBuildStep(),f||(f=o.doBuildStep());if(0!==u()){if(l(i,o))return a(i,o);throw h("Resulting forward graph results",i.wiredGraphs),h("Resulting backward graph results",o.wiredGraphs),new Error("not yet implemented, forwardWiredGraphs.length="+i.wiredGraphs.length+", backwardWiredGraphs.length="+o.wiredGraphs.length)}switch(c=i.getMergedGraph(),c.length){case 0:return null;case 1:return c[0];default:throw h("found graphs",c),new Error("internal error, found to many graphs")}},h=function(e,r){return ut.simulations.electricity.printGraphResults(e,r)},c={state:"not started",error:!0,graph:null},Object.defineProperties(this,{result:{value:c,writable:!1,configurable:!1}}),(s=function(e){return function(){var r,t,o,a,s;if(r=function(){var e;return e=u(n.fromNode,n.toNode,[n]),e&&i(e),e},a=Date.now(),t=null,t=r(),null===t)try{t=r()}catch(e){o=e,console.log(o+": "+o.message)}if(s=Date.now()-a,!t)return c.state="failed";switch(t.resultType){case"shortCircuit":return c.state="shortCircuit",c.graph=t,c.error=!1;default:return e.debug&&h("createdGraphs",[t]),c.state="foundGraph",c.graph=t,c.error=!1}}}(this))()}return e}()}).call(this);
//# sourceMappingURL=createDirectedGraph.js.map
