var ut;!function(n){var t;!function(t){var o;!function(t){"use strict";t.debugModelCalculations=!1,t.nonComponentType="NONE";var o=function(){function n(n,o){this._xPos=n,this._yPos=o,this._id="",this._positionId="",this._positionId=n+"_"+o,this._id=n+"_"+o+"_"+t.nonComponentType}return n.prototype.getXPos=function(){return this._xPos},n.prototype.getYPos=function(){return this._yPos},n.prototype.getId=function(){return this._id},n.prototype.getPositionId=function(){return this._positionId},n.prototype.getDisplayId=function(){return this._id},n.prototype.getComponentType=function(){return"NONE"},n.prototype.isNone=function(){return!0},n.prototype.getConnections=function(){return[]},n.prototype.isPowerSupply=function(){return!1},n.prototype.isBattery=function(){return!1},n.prototype.isOmhMeterSource=function(){return!1},n.prototype.isNonPowerSupplyComponent=function(){return!1},n.prototype.isWire=function(){return!1},n.prototype.isPowerSupplyMinus=function(n){return!1},n.prototype.isDcVoltageSource=function(){return!1},n.prototype.isAcVoltageSource=function(){return!1},n.prototype.isSwitch=function(){return!1},n.prototype.isResistor=function(){return!1},n.prototype.hasImpedance=function(){return!1},n.prototype.setVoltage=function(n){},n.prototype.getVoltage=function(n){return 0},n.prototype.getTheVoltage=function(){return 0},n.prototype.getResistance=function(){return 0},n.prototype.getImpedance=function(n){return t.Complex.zero},n.prototype.getDefinedNrOfConnections=function(){return 0},n.prototype.getJson=function(){return{type:this.getComponentType(),x:this._xPos,y:this._yPos,rotate:0,id:this._id}},n}();t.NonComponent=o;var e=function(){function o(n){this._components=n,this._debug=t.debugModelCalculations,this._connectionPoints=[],this._connectionLinks=new t.LinkArray,this.createConnectionGraph(),this._debug&&(this.printComponents(),this.printConnectionPoints())}return Object.defineProperty(o.prototype,"connectionPoints",{get:function(){return this._connectionPoints},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"connectionLinks",{get:function(){return this._connectionLinks},enumerable:!0,configurable:!0}),o.prototype.createConnectionGraph=function(){var o=this,e=[],i=function(n,e,i,r){for(var c=0,s=o._connectionPoints;c<s.length;c++){var u=s[c];if(u.isValidFor(n,i))return u}var a=new t.ConnectionPoint(n,e,i,r);return o._connectionPoints.push(a),a},r=function(t,o){for(var i=0,r=e;i<r.length;i++){var c=r[i];if(c.getXPos()===t&&c.getYPos()===o)return c}var s=new n.simulations.electricity.NonComponent(t,o);return e.push(s),s},c=function(n,t){for(var e=0,i=o._components;e<i.length;e++){var c=i[e];if(c.getXPos()===n&&c.getYPos()===t)return c}return r(n,t)},s=function(n,t){var o=n.getXPos(),e=n.getYPos();switch(t){case"north":e+=-1;break;case"east":o+=1;break;case"south":e+=1;break;case"west":o+=-1;break;default:throw new Error("CreateBiDirectionalGraph.createConnectionGraph.getConnectingComponent("+n.getId()+", "+t+") unknwon direction")}return c(o,e)},u=function(n){switch(n){case"north":return"south";case"east":return"west";case"south":return"north";case"west":return"east";default:throw new Error("CreateBiDirectionalGraph.createConnectionGraph.swapDirection("+n+") unknwon direction")}},a=function(t,e){var r=t.getConnections(e);if(0!==r.length){var c=s(t,e);if(c){var a=u(e),p=i(t,e,c,a),f=function(e){var r=s(e.getComponent(),e.getTo()),c=i(t,e.getTo(),r,u(e.getTo())),a=new n.simulations.electricity.ConnectionLink(p,c,e.getComponent());o._connectionLinks.addLink(a)};r.forEach(f)}}},p=function(){var n=o._connectionLinks.asArray();n.forEach(function(n){var e=o._connectionLinks.asArray().filter(function(t){return t.fromNode===n.toNode&&t.toNode===n.fromNode});switch(e.length){case 0:var i=new t.ConnectionLink(n.toNode,n.fromNode,n.getComponent());o._connectionLinks.addLink(i);break;case 1:break;default:console.warn("CreateBiDirectionalGraph.createConnectionGraph.createBackLinksFromEndPoints(): unexpected number ("+e.length+") of back links for "+n)}})},f=function(){var e=function(e,i){var r=[];i.forEach(function(n){r.push(n.fromNode),o._connectionLinks.removeLink(n)});var c=new n.simulations.electricity.ConnectionPoint(e,"center",e,"center",(!0));o._connectionPoints.push(c),r.forEach(function(n){var i=new t.ConnectionLink(c,n,e);o._connectionLinks.addLink(i);var r=new t.ConnectionLink(n,c,e);o._connectionLinks.addLink(r)})};o._components.forEach(function(n){switch(n.getComponentType()){case"split":case"cross":var t=o._connectionLinks.getFilteredLinks(function(t){return t.component===n});t.length>2&&e(n,t)}})};this._components.forEach(function(n){a(n,"north"),a(n,"east"),a(n,"south"),a(n,"west")}),p(),f()},o.prototype.getConnectionPoint=function(n,t){for(var o=function(n){return n?n.getPositionId():null},e=0,i=this._connectionPoints;e<i.length;e++){var r=i[e],c=o(r.getComponent1()),s=o(r.getComponent2());if(c===n&&s===t||c===t&&s===n)return r}return null},o.prototype.printComponents=function(){console.log("All components:");var n=0;this._components.forEach(function(t){console.log(" "+n+": "+t.getDisplayId()),++n})},o.prototype.printConnectionPoints=function(){var n=this;console.log("ConnectionLinks:\n"+this._connectionLinks.getAllLinksAsString(" ")),console.log("ConnectionPoints:");var t=0;this._connectionPoints.forEach(function(o){console.log(" "+t+": "+o);var e=0;n._connectionLinks.getFromLinks(o).forEach(function(n){console.log("  "+e+": to "+n.toNode),++e}),++t})},o}();t.CreateBiDirectionalGraph=e}(o=t.electricity||(t.electricity={}))}(t=n.simulations||(n.simulations={}))}(ut||(ut={}));
//# sourceMappingURL=createBiDirectionalGraph.js.map
