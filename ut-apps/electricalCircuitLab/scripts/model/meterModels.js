var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},ut;!function(t){var e;!function(e){var r;!function(e){"use strict";var r=function(t){function e(e){t.call(this),this.meter=e}return __extends(e,t),e.prototype.getImageInformation=function(){return{type:"commonImage",value:this.meter.getType()+"Meter.png"}},e.prototype.getType=function(){return"number"},e.prototype.getId=function(){return this.meter.getId()},e.prototype.getLabel=function(){return this.meter.getLabel()},e.prototype.getUnit=function(){return this.meter.getUnit()},e.prototype.getValue=function(){return this.meter.getValue().value},e}(t.commons.DataSourceColumn);e.MeterDataSourceColumn=r;var n=function(){function t(t,e,n,o,s,i,u,a){switch(this.meterId=t,this.meterType=e,this.unit=n,this.minFactor=o,this.maxFactor=s,this.meterNr=i,this.label=u,this._acMode=a,this.sensors=[],this.dataSourceColumn=null,this.value=null,i){case 0:case 1:case 2:break;default:throw new Error("meterNr must be 0, 1 or 2, but is "+this.meterNr)}if(o>s)throw new Error("minFactor ("+o+") must be smaller or equal then maxFactor ("+s+")");this.clear(),this.dataSourceColumn=new r(this)}return Object.defineProperty(t.prototype,"acMode",{get:function(){return this._acMode},set:function(t){this._acMode!==t&&(this._acMode=t,this.sensorStateChanged())},enumerable:!0,configurable:!0}),t.prototype.getId=function(){return this.meterId},t.prototype.getType=function(){return this.meterType},t.prototype.getUnit=function(){return this.unit},t.prototype.getMeterNr=function(){return this.meterNr},t.prototype.getLabel=function(){return this.label},t.prototype.getDataSourceColumn=function(){return this.dataSourceColumn},t.prototype.getSensors=function(){return this.sensors},t.prototype.addSensor=function(t){t.setMeter(this),this.sensors.push(t)},t.prototype.getValue=function(){return this.value},t.prototype.setFormattedValue=function(t){this.value=e.formatValue(t,this.minFactor,this.maxFactor,this.unit)},t.prototype.sensorStateChanged=function(){var t=this.sensors.every(function(t){return t.isPlaced()&&t.isConnected()}),e=t?this.calculateValue():0;this.setFormattedValue(e)},t.prototype.calculateValue=function(){return 0},t.prototype.updateState=function(){},t.prototype.clear=function(){this.setFormattedValue(0),this.sensors.forEach(function(t){return t.sensorStateChanged()})},t.prototype.getConfigJson=function(){return{type:this.getType(),label:this.getLabel(),minFactor:this.minFactor,maxFactor:this.maxFactor}},t}();e.MeterModel=n;var o=function(){function t(t,e,r,n,o){void 0===o&&(o=!1),this.meterId=t,this.meterNr=e,this.sensorNr=r,this.sensorType=n,this.hidden=o,this.sensorId="",this.cmpId1="",this.cmpId2="",this.displayId="",this.placeCounter=0,this.state=null,this.meter=null,this.sensorId=t+"_"+r}return t.prototype.toString=function(){return"SensorModel{id="+this.getId()+",cmpId1="+this.cmpId1+",cmpId2="+this.cmpId2+"}"},t.prototype.getId=function(){return this.sensorId},t.prototype.getNr=function(){return this.sensorNr},t.prototype.getType=function(){return this.sensorType},t.prototype.getMeterId=function(){return this.meterId},t.prototype.getMeterNr=function(){return this.meterNr},t.prototype.getDisplayId=function(){return this.displayId},t.prototype.setDisplayId=function(t){this.displayId=t},t.prototype.isHidden=function(){return!!this.hidden},t.prototype.setMeter=function(t){this.meter=t},t.prototype.place=function(t){this.cmpId1=t.cmpId1,this.cmpId2=t.cmpId2,this.updateLocation()},t.prototype.remove=function(){this.cmpId1="",this.cmpId2="",this.updateLocation()},t.prototype.updateLocation=function(){++this.placeCounter},t.prototype.getPlace=function(){return{cmpId1:this.cmpId1,cmpId2:this.cmpId2}},t.prototype.isPlaced=function(){return this.cmpId1.length>0&&this.cmpId2.length>0},t.prototype.isConnected=function(){return null!==this.state},t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){this.state=t,this.sensorStateChanged()},t.prototype.sensorStateChanged=function(){this.meter&&this.meter.sensorStateChanged()},t.prototype.getCurrentValue=function(){return this.state?this.state.acCurrent.modulus():0},t.prototype.getVoltageValue=function(){return this.state?(console.log("sensor("+this.sensorId+"): acVoltage: "+this.state.acVoltage.toString()+" -> "+this.state.acVoltage.modulus()),this.state.acVoltage.modulus()):0},t.prototype.getJson=function(){return{id:this.getId(),type:this.getType(),meterId:this.getMeterId(),meterNr:this.getMeterNr(),cmpId1:this.cmpId1,cmpId2:this.cmpId2}},t}();e.SensorModel=o;var s=function(t){function e(e,r,n,s,i,u){t.call(this,e,"ampere","A",r,n,s,i,u),this.currentSensor=null,this.currentSensor=new o(e,s,0,"ampere"),this.addSensor(this.currentSensor)}return __extends(e,t),e.prototype.calculateValue=function(){return this.acMode?this.currentSensor.getState().acCurrent.distance:this.currentSensor.getState().acCurrent.real},e}(n);e.AmpereMeterModel=s;var i=function(t){function e(e,r,n,s,i,u){t.call(this,e,"volt","V",r,n,s,i,u),this.minusSensor=null,this.plusSensor=null,this.minusSensor=new o(e,s,0,"voltMinus"),this.plusSensor=new o(e,s,1,"voltPlus"),this.addSensor(this.minusSensor),this.addSensor(this.plusSensor)}return __extends(e,t),e.prototype.calculateValue=function(){if(this.acMode){var t=this.plusSensor.getState().acVoltage.subtract(this.minusSensor.getState().acVoltage);return t.distance}return this.plusSensor.getState().acVoltage.real-this.minusSensor.getState().acVoltage.real},e}(n);e.VoltMeterModel=i;var u=Math.PI/180,a=function(t){function e(e,r,n,s,i,u){t.call(this,e,"watt","W",r,n,s,i,u),this.minusAndCurrentSensor=null,this.plusSensor=null,this.minusAndCurrentSensor=new o(e,s,0,"wattVA"),this.plusSensor=new o(e,s,1,"wattV"),this.addSensor(this.minusAndCurrentSensor),this.addSensor(this.plusSensor)}return __extends(e,t),e.prototype.calculateValue=function(){if(this.acMode){var t=this.plusSensor.getState().acVoltage.subtract(this.minusAndCurrentSensor.getState().acVoltage),e=this.minusAndCurrentSensor.getState().acCurrent,r=t.multiply(e),n=t.angle-e.angle,o=Math.cos(n*u),s=Math.abs(o*r.distance);return s}var t=this.plusSensor.getState().acVoltage.real-this.minusAndCurrentSensor.getState().acVoltage.real;return Math.abs(t*this.minusAndCurrentSensor.getState().acCurrent.real)},e}(n);e.WattMeterModel=a;var c=function(t){function e(e,r,n,o,s,i,u){t.call(this,e,"ohm","Î©",r,n,o,s,i),this.circuitSimulatorEngine=u}return __extends(e,t),e.prototype.calculateValue=function(){var t=this,e=1/0,r=function(){for(var e=function(t){return t.circuitResult.isOhmMeterCircuit},r=0,n=t.circuitSimulatorEngine.getCircuits();r<n.length;r++){var o=n[r];if(e(o))return o}return null},n=r();if(n&&n.circuitResult)if("brokenCircuitFound"===n.circuitResult.state)e=1/0;else if("shortCircuit"===n.circuitResult.state||"lateShortCircuit"===n.circuitResult.state)e=0;else if(!n.circuitResult.error&&n.circuitResult.circuitProperties){var o=n.circuitResult.circuitProperties.impedance.distance;o<=9999*Math.pow(10,3*this.maxFactor)&&(e=o)}return e},e.prototype.updateState=function(){this.sensorStateChanged()},e}(n);e.OhmMeterModel=c}(r=e.electricity||(e.electricity={}))}(e=t.simulations||(t.simulations={}))}(ut||(ut={}));
//# sourceMappingURL=meterModels.js.map
