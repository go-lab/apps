(function(){"use strict";var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;window.ut=window.ut||{},ut.commons=ut.commons||{},ut.commons.ResourceEventEmitterModel=ut.commons.ResourceEventEmitterModel||{},ut.simulations=ut.simulations||{},ut.simulations.electricity=ut.simulations.electricity||{},ut.simulations.electricity.ListForObjectsWithId=function(){function t(){this._clear()}return t.prototype._clear=function(){return this.list=[],this.map={}},t.prototype.getList=function(){return this.list},t.prototype.getObject=function(t){return this.map[t]},t.prototype.addObject=function(t){return this.list.push(t),this.map[t.getId()]=t},t.prototype.replaceObjects=function(t){var e,o,r,n;for(this._clear(),n=[],e=0,o=t.length;e<o;e++)r=t[e],this.map[r.getId()]?n.push(console.warn("duplicate object: "+r)):n.push(this.addObject(r));return n},t}(),ut.simulations.electricity.AvailableMeters=function(o){function r(){this.getMeters=t(this.getMeters,this),r.__super__.constructor.call(this)}return e(r,o),r.prototype._clear=function(){return r.__super__._clear.call(this),this.sensorsMap={}},r.prototype.getMeters=function(){return this.getList()},r.prototype.getMeter=function(t){return this.getObject(t)},r.prototype.getSensor=function(t){return this.sensorsMap[t]},r.prototype.addObject=function(t){var e,o,n,s,i;for(r.__super__.addObject.call(this,t),n=t.getSensors(),s=[],e=0,o=n.length;e<o;e++)i=n[e],s.push(this.sensorsMap[i.getId()]=i);return s},r.prototype.replaceMeters=function(t){return this.replaceObjects(t)},r}(ut.simulations.electricity.ListForObjectsWithId),ut.simulations.electricity.AvailablePowerSupplies=function(o){function r(){this.getPowerSupplies=t(this.getPowerSupplies,this),r.__super__.constructor.call(this)}return e(r,o),r.prototype.getPowerSupplies=function(){return this.getList()},r.prototype.getPowerSupply=function(t){var e;return e=this.getObject(t),e||console.warn("failed to find power supply with id "+t),e},r.prototype.replacePowerSupplies=function(t){return this.replaceObjects(t)},r}(ut.simulations.electricity.ListForObjectsWithId),ut.simulations.electricity.CircuitBoardModel=function(t){function o(t,e,r){this.configurationModel=r,o.__super__.constructor.call(this,t,"circuit"),this.actionLogger=new window.ut.simulations.electricity.CircuitSimulatorActionLogger(this.actionLogger),this.components={},this.placedSensors={},this.dataGraphModel=e,this.availableMeters=new ut.simulations.electricity.AvailableMeters,this.availablePowerSupplies=new ut.simulations.electricity.AvailablePowerSupplies,this.powerSource=null,this.modelCounter=0,this.errorMessage="",this._circuitSimulatorEngine=null}return e(o,t),o.prototype.createNewModel=function(){var t,e;return e=this.dataGraphModel?this.dataGraphModel.createNewModel():null,t=new window.ut.simulations.electricity.CircuitBoardModel(this.environmentHandlers,e,this.configurationModel),this.configurationModel.addCircuitBoardModel(t),t},o.prototype.getCircuitSimulatorActionLogger=function(){return this.actionLogger},o.prototype.setCircuitSimulatorEngine=function(t){return this._circuitSimulatorEngine=t},o.prototype.initialLoadingFinished=function(){return this.emitModelLoaded(),this.clearChanged()},o.prototype.isEmpty=function(){return 0===Object.keys(this.components).length&&0===Object.keys(this.placedSensors).length},o.prototype.getAvailableMeters=function(){return this.availableMeters},o.prototype.getAvailablePowerSupplies=function(){return this.availablePowerSupplies},o.prototype.getDataGraphModel=function(){return this.dataGraphModel},o.prototype.equals=function(t){var e,o,r;if(e=function(t){var e;return e=t.getResource(),delete e.content.dataGraphModel,JSON.stringify(e)},this.dataGraphModel){if(!t.dataGraphModel)return!1;if(!this.dataGraphModel.equals(t.dataGraphModel))return!1}return o=e(this),r=e(t),o===r},o.prototype.applyLogLoad=function(t,e,r){switch(e){case"dataSet":case"data":if(this.dataGraphModel)return this.dataGraphModel.applyLogLoad(t,e,r);break;default:return o.__super__.applyLogLoad.call(this,t,e,r)}},o.prototype.applyLogSave=function(t,e,r){switch(e){case"dataSet":case"data":if(this.dataGraphModel)return this.dataGraphModel.applyLogSave(t,e,r);break;default:return o.__super__.applyLogSave.call(this,t,e,r)}},o.prototype.applyLogSaveAs=function(t,e,r){switch(e){case"dataSet":case"data":if(this.dataGraphModel)return this.dataGraphModel.applyLogSaveAs(t,e,r);break;default:return o.__super__.applyLogSaveAs.call(this,t,e,r)}},o.prototype.applyLogClear=function(t,e,r){var n;switch(e){case"dataSet":case"data":if(this.dataGraphModel)return this.dataGraphModel.applyLogClear(t,e,r),n=!0;break;default:return o.__super__.applyLogClear.call(this,t,e,r)}},o.prototype.applyLogAdd=function(t,e){var o,r,n,s;switch(o=!1,t.object.objectType){case"component":r=new ut.simulations.electricity.ComponentModel(t.object.content),this.addComponent(r);break;case"sensor":s=this.getAvailableMeters().getSensor(t.object.id),s&&(s.place(t.object.content),this.addSensor(s));break;case"dataSource":case"data":this.dataGraphModel&&(this.dataGraphModel.applyLogAdd(t,e),o=!0);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(null!=(n=this._circuitSimulatorEngine)&&n.circuitChanged(),!o)return e(null)},o.prototype.applyLogChange=function(t,e){var o,r,n,s,i,a,p,c;switch(t.object.objectType){case"component":o=this.getComponent(t.object.id),o&&(r=t.object.content,r.x===o.getXPos()&&r.y===o.getYPos()||o.setLocation({left:r.x,top:r.y}),r.rotate!==o.getRotate()&&o.setRotate(r.rotate),r.resistance&&r.resistance!==o.getResistance()&&o.setResistance(r.resistance),r.type!==o.getComponentType()&&o.switch(r.type));break;case"sensor":p=this.getAvailableMeters().getSensor(t.object.id),p&&(c=t.object.content,n=p.getPlace(),c.cmpId1===n.cmpId1&&c.cmpId2===n.cmpId2||p.place(c));break;case"powerSupply":i=t.object.content,s=this.powerSource&&this.powerSource.getId()===i.id?this.powerSource:null,s?(s.getShortCircuit()!==i.shortCircuit&&s.setShortCircuit(i.shortCircuit),s.voltage.getValue().value!==i.voltage.value&&s.voltage.setFormattedValue(i.voltage.value),s.frequency.getValue().value!==i.frequency.value&&s.frequency.setFormattedValue(i.frequency.value)):console.warn("Could not find powerSource with id "+i.id);break;default:console.warn("Unknown object type: "+t.object.objectType)}return null!=(a=this._circuitSimulatorEngine)&&a.circuitChanged(),e(null)},o.prototype.applyLogRemove=function(t,e){var o,r;switch(o=!1,t.object.objectType){case"component":this.removeComponent(t.object.id);break;case"sensor":this.removeSensor(t.object.id);break;case"dataSource":this.dataGraphModel&&(this.dataGraphModel.applyLogRemove(t,e),o=!0);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(null!=(r=this._circuitSimulatorEngine)&&r.circuitChanged(),!o)return e(null)},o.prototype.getResourceContent=function(){var t;return t={components:this.getComponentsJson(),sensors:this.getSensorsJson(),powerSupplies:this.getPowerSuppliesJson()},this.dataGraphModel&&(t.dataGraphModel=this.dataGraphModel.getResource()),t},o.prototype.loadFromResourceContent=function(t){if(this.clearContent(),t&&(t.components&&this.loadComponents(t.components),t.sensors&&this.loadSensors(t.sensors),t.powerSupplies&&this.loadPowerSupplies(t.powerSupplies),t.dataGraphModel&&this.dataGraphModel))return this.dataGraphModel.loadFromResource(t.dataGraphModel)},o.prototype.clearContent=function(){var t,e,r,n,s,i,a;this.components={},n=this.placedSensors;for(t in n)a=n[t],a.remove();this.placedSensors={},s=this.availableMeters.getMeters();for(t in s)e=s[t],e.clear();i=this.availablePowerSupplies.getPowerSupplies();for(t in i)r=i[t],r.clear();return this.dataGraphModel&&this.dataGraphModel.clear(),++this.modelCounter,o.__super__.clearContent.call(this)},o.prototype.getComponentsJson=function(){var t,e,o,r;o=this.components,r=[];for(e in o)t=o[e],r.push(t.getJson());return r},o.prototype.loadComponents=function(t){var e,o,r,n,s;for(s=[],r=0,n=t.length;r<n;r++)o=t[r],e=new ut.simulations.electricity.ComponentModel(o),s.push(this.addComponent(e));return s},o.prototype.loadSensors=function(t){var e,o,r,n,s;for(r=[],e=0,o=t.length;e<o;e++)s=t[e],n=this.availableMeters.getSensor(s.id),n?(n.place(s),r.push(this.addSensor(n))):r.push(console.warn("can't find sensor: "+JSON.stringify(s)));return r},o.prototype.getSensorsJson=function(){var t,e,o,r;e=this.placedSensors,o=[];for(t in e)r=e[t],"light"!==r.getType()&&o.push(r.getJson());return o},o.prototype.getPowerSuppliesJson=function(){return this.powerSource?[this.powerSource.getJson()]:[]},o.prototype.loadPowerSupplies=function(t){var e,o,r,n;for(n=[],e=0,o=t.length;e<o;e++)r=t[e],this.powerSource&&this.powerSource.getId()===r.id?(this.powerSource.loadFromJson(r),n.push(this.powerSource.acMode=this.configurationModel.acMode)):n.push(void 0);return n},o.prototype.getComponents=function(){var t,e,o,r;o=this.components,r=[];for(e in o)t=o[e],r.push(t);return r},o.prototype.isComponentPositionFree=function(t){var e,o,r;r=this.components;for(o in r)if(e=r[o],e.getXPos()===t.left&&e.getYPos()===t.top)return!1;return!0},o.prototype.getComponentAt=function(t,e){var o,r,n;n=this.components;for(r in n)if(o=n[r],o.getXPos()===t&&o.getYPos()===e)return o;return null},o.prototype.addComponent=function(t){return this.components[t.getId()]=t,t.getSensor()&&this.addSensor(t.getSensor()),this.emitModelChanged()},o.prototype.removeComponent=function(t){return t instanceof ut.simulations.electricity.ComponentModel?(delete this.components[t.getId()],t.getSensor()&&this.removeSensor(t.getSensor())):delete this.components[t],this.emitModelChanged()},o.prototype.getComponent=function(t){return this.components[t]},o.prototype.getPlacedSensors=function(){var t,e,o,r;e=this.placedSensors,o=[];for(t in e)r=e[t],o.push(r);return o},o.prototype.getPlacedSensor=function(t){return this.placedSensors[t]},o.prototype.isSensorPositionFree=function(t){var e,o,r;o=this.placedSensors;for(e in o)if(r=o[e],!r.isHidden()&&r.cmpId1===t.cmpId1&&r.cmpId2===t.cmpId2)return!1;return!0},o.prototype.addSensor=function(t){return this.placedSensors[t.getId()]=t,this.emitModelChanged()},o.prototype.removeSensor=function(t){var e;return t instanceof ut.simulations.electricity.SensorModel?(e=t,delete this.placedSensors[t.getId()]):(e=this.placedSensors[t],delete this.placedSensors[t]),null!=e&&e.remove(),this.emitModelChanged()},o.prototype.removeAllSensors=function(){return this.placedSensors={}},o.prototype.setPowerSource=function(t){if(this.powerSource!==t)return this.powerSource=t,this.emitEvent("powerSourceChanged",[t]),this.emitModelChanged()},o.prototype.getMaxComponentXPos=function(){var t,e,o,r;if(0===this.components.length)return 0;o=0,r=this.components;for(e in r)t=r[e],t.getXPos()>o&&(o=t.getXPos());return o+1},o.prototype.getMaxComponentYPos=function(){var t,e,o,r;if(0===this.components.length)return 0;o=0,r=this.components;for(e in r)t=r[e],t.getYPos()>o&&(o=t.getYPos());return o+1},o.prototype.getNrOfConnections=function(t){var e,o;return o=0,e=function(t){return function(e,o,r){var n;return n=t.getComponentAt(e,o),!!n&&n.hasConnection(r)}}(this),t.hasConnection("north")&&e(t.getXPos(),t.getYPos()-1,"south")&&++o,t.hasConnection("west")&&e(t.getXPos()-1,t.getYPos(),"east")&&++o,t.hasConnection("south")&&e(t.getXPos(),t.getYPos()+1,"north")&&++o,t.hasConnection("east")&&e(t.getXPos()+1,t.getYPos(),"west")&&++o,o},o.prototype.rotateComponentOptimal=function(t){var e,o,r,n,s,i,a;for(i=0,n=this.getNrOfConnections(t),a=[90,180,270],o=0,r=a.length;o<r;o++)e=a[o],t.setRotate(e),s=this.getNrOfConnections(t),s>n&&(n=s,i=e);return t.setRotate(i)},o.prototype.getErrorMessage=function(){return this.errorMessage},o.prototype.setErrorMessage=function(t){return this.errorMessage=t},o}(window.ut.commons.ResourceEventEmitterModel)}).call(this);
//# sourceMappingURL=circuitBoardModel.org.js.map
