var ut;!function(e){var t;!function(t){var n;!function(t){"use strict";var n=function(t){return{restrict:"E",template:'\n<div>\n   <div class="device dcPowerSupply">\n     <div class="iconLabel" draggable helper="clone" objectType="meter" objectId="{{powerSupply.voltage.getId()}}">\n       <div class="deviceIcon"\n         ng-class="{shortCircuit:powerSupply.getShortCircuit(), commonImage_dcVoltageSourceMeter:!configurationModel.acMode, commonImage_acVoltageSourceMeter:configurationModel.acMode}"\n         Xng-click="togglePowerState()"/>\n       <div class="label">{{powerSupply.getLabel()}}</div>\n     </div>\n     <rangedMeterModel control="voltage"></rangedMeterModel>\n   </div>\n   <div class="device dcPowerSupply" ng-show="configurationModel.acMode">\n     <div class="iconLabel" draggable helper="clone" objectType="meter" objectId="{{powerSupply.frequency.getId()}}">\n       <div class="deviceIcon commonImage_frequencySourceMeter"\n         ng-class="{shortCircuit:powerSupply.getShortCircuit()}"/>\n       <div class="label">{{powerSupply.getLabel()}}</div>\n     </div>\n     <rangedMeterModel control="frequency"></rangedMeterModel>\n   </div>\n</div>\n',replace:!0,link:function(t,n,o){var r=t,a=r.powerSupply;r.getDragAndDropTransferObject=function(t){return t.dropObjectId===a.voltage.getId()?new e.simulations.electricity.ElectricityLabDataSourceColumnDrop(a.voltage.getDataSourceColumn()):t.dropObjectId===a.frequency.getId()?new e.simulations.electricity.ElectricityLabDataSourceColumnDrop(a.frequency.getDataSourceColumn()):void console.warn("getDragAndDropTransferObject for unknown power model part: "+t.dropObjectId)}}}};t.circuitsimulator.directive("powerSupply".toLowerCase(),["configurationModel",n]);var o=function(){return{restrict:"E",template:'\n<div>\n  <span class="display">\n      <input type="text" ng-model="powerValue" number="newNumber" ng-enter="enterKey()" class="displayInput">\n      {{ powerUnit }}\n  </span>\n  <powerControl></powerControl>\n</div>\n',replace:!0,scope:!0,link:function(t,n,o){var r=t,a=r.circuitModel.getCircuitSimulatorActionLogger(),i=r.powerSupply,c=o.control,l=i[c];if(!l)throw new Error("cannot find rangedMeterModel with name "+c+" in powerModel");r.rangedMeterModel=l;var u=function(){r.powerValue=l.getValue().displayNumber,r.powerUnit=l.getValue().displayUnit};t.$watch("powerSupply."+c+".getValue().value",function(){u()}),r.newNumber=function(e){e!==l.getValue().displayNumber&&(l.setFormattedValue(e*l.getValue().factorValue),u(),a.logPowerAction(r.powerSupply))},r.enterKey=function(){r.newNumber(r.powerValue)},r.getDragAndDropTransferObject=function(){return new e.simulations.electricity.ElectricityLabDataSourceColumnDrop(r.powerSupply.getDataSourceColumn())}}}};t.circuitsimulator.directive("rangedMeterModel".toLowerCase(),[o]);var r=500,a=16.666,i=2500,c=300,l=function(e,t){return{restrict:"E",template:'\n<div class="powerControl">\n  <i class="fa fa-angle-up fa-fw activeButton fontAweSomeButton increasePower"></i>\n  <i class="fa fa-angle-down fa-fw activeButton fontAweSomeButton decreasePower"></i>\n</div>\n',replace:!0,link:function(t,n,o){var l=t,u=l.circuitModel.getCircuitSimulatorActionLogger(),p=function(t,n){var o=null,p=null,d=null,s=r,g=0,w=0*n,f=w,v=0,m=!1,y=Date.now(),S=0,M=0,b=function(){if(m){var t=f,n=s,w=0,D=0,C=Date.now();if(S>0){w=C-y,D=C-S;var h=1;++g,w<i?(n=a+(i-w)/i*(r-a),h=1):(n=a,h=1+(w-i)/a/5),t=D/(s+n)*2*f*h}var V=v+t,I=Math.round(V/f)*f;if(v=V,o.setFormattedValue(I),S=C,s=n,d=e(b,s),Date.now()>=M){var P=o.getValue().value;P!==p&&(u.logPowerAction(l.powerSupply),p=P),M=Date.now()+c}}},D=function(e){e.stopPropagation(),m||(o=l.rangedMeterModel,p=null,s=r,g=0,w=n*o.getStepValue(),f=w,v=o.getValue().value,m=!0,y=Date.now(),S=0,M=Date.now()+c,b(),l.$apply())},C=function(t){t.stopPropagation();var n=m;m=!1,e.cancel(d),n&&u.logPowerAction(l.powerSupply)};return t.on("mousedown",function(e){D(e)}),t.on("mouseup",function(e){C(e)}),t.on("mouseleave",function(e){C(e)}),t.on("touchstart",function(e){D(e)}),t.on("touchmove",function(e){}),t.on("touchend",function(e){C(e)}),t.on("touchcancel",function(e){C(e)})},d=n.find(".increasePower");p(d,1);var s=n.find(".decreasePower");p(s,-1),l.switchPowerOff=function(){l.powerSupply.setState(!1)},l.switchPowerOn=function(){l.powerSupply.setState(!0)}}}};t.circuitsimulator.directive("powerControl".toLowerCase(),["$timeout","$interval",l]);var u=function(){return{restrict:"A",link:function(e,t,n,o){return t.filter_input({regex:"[0-9.-]"}),t.change(function(){var o=t.val(),r=parseFloat(o.trim());e.$apply(n.number+("("+r+")"))})}}};t.circuitsimulator.directive("number",[u])}(n=t.electricity||(t.electricity={}))}(t=e.simulations||(e.simulations={}))}(ut||(ut={}));
//# sourceMappingURL=power.js.map
