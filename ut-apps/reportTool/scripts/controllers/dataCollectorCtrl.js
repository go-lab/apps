(function(){"use strict";var e,t,o,a;window.ut=window.ut||{},ut.commons=ut.commons||{},ut.tools=ut.tools||{},ut.tools.dataviewer=ut.tools.dataviewer||{},window.google=window.google||{},window.google.visualization=window.google.visualization||{},t=window.JSONR||{},e=function(){function e(e){this.dataSet=e,this.dataSourceColumnDataSourceMap={},this.dataSourceColumnFactory=null,this.dataSet.addListeners(["modelLoaded","modelCleared"],function(e){return function(){return e.updateDataSourceColumns()}}(this))}return e.prototype.setDataSourceColumnFactory=function(e){return this.dataSourceColumnFactory=e,this.updateDataSourceColumns()},e.prototype.updateDataSourceColumns=function(){var e,t,o,a,r,u,n;if(this.dataSourceColumnFactory){for(this.dataSourceColumnDataSourceMap={},t=this.dataSet.getDataSourceColumns(),n=[],r=0,u=t.length;r<u;r++)e=t[r],o=this.dataSourceColumnFactory.getDataSource(e.getId()),a=this.dataSourceColumnFactory.getDataSourceColumn(e.getId()),o&&a?(this.dataSourceColumnDataSourceMap[e.getId()]=o,n.push(this.dataSet.updateDataSourceColumn(a))):n.push(void 0);return n}},e.prototype.addDataSourceColumnDrop=function(e){var t,o,a,r,u,n;for(t=e.getDataSource(),u=e.getDataSourceColumns(),n=[],o=0,a=u.length;o<a;o++)if(r=u[o],this.dataSourceColumnDataSourceMap[r.getId()]){if(this.dataSourceColumnDataSourceMap[r.getId()]!==t)throw new Error("Cannot add new DataSourceColumn with id "+r.getId()+", because that id is already present from an other DataSource");n.push(void 0)}else this.dataSourceColumnDataSourceMap[r.getId()]=t,n.push(this.dataSet.addDataSourceColumn(r));return n},e.prototype.removeDataSourceColumn=function(e){return delete this.dataSourceColumnDataSourceMap[e],this.dataSet.removeDataSourceColumnById(e)},e.prototype.getDataSourceColumn=function(e){return this.dataSet.getDataSourceColumn(e)},e.prototype.getDataSourceColumnsOrderedByDataSource=function(){var e,t,o,a,r,u,n;for(o=[],a=function(e){var t,a,r;for(a=0,r=o.length;a<r;a++)if(t=o[a],t.dataSource===e)return t;return t={dataSource:e,dataSourceColumns:[]},o.push(t),t},n=this.dataSet.getDataSourceColumns(),r=0,u=n.length;r<u;r++)e=n[r],t=a(this.dataSourceColumnDataSourceMap[e.getId()]),t.dataSourceColumns.push(e);return o},e}(),a={dropObjectId:"",dropObjectType:"",dragAndDropTransferObject:null,DataSourceColumnDrop:null,askQuestion:{}},o=function(t,o,a,r){var u,n,s;return u=o.getDataSetActionLogger(),t.dataSetJson="",t.dataSet=o,n=new e(o),t.setDataSourceColumnFactory=function(e){return n.setDataSourceColumnFactory(e)},s=function(){return t.dataSetJson=JSON.stringify(o.getResource())},s(),o.addListener("modelChanged",function(){return s()}),t.acceptObjectDrop=function(e,t){var o,a;return a=e.dragAndDropTransferObject,o=!1,a&&a instanceof ut.commons.DataSourceColumnDrop&&(o=!0),o},t.objectDroppedInside=function(e,t){var o;return t.remove(),o=e.dragAndDropTransferObject,o?(n.addDataSourceColumnDrop(o),u.logColumnsAdded(o.getDataSourceColumns())):console.log("drop has no dragAndDropTransferObject")},t.objectDroppedOutside=function(e,t){var o;return t.remove(),o=n.getDataSourceColumn(e.dropObjectId),o?(n.removeDataSourceColumn(e.dropObjectId),u.logColumnRemoved(o)):console.warn("trying to remove unknown data source: "+JSON.stringify(e))},t.addData=function(){var e,t,a,r,s,d,c,l,i,S,g,m,D,p,f,h,C,w,v,y,O,I,b;if(0!==o.getNrOfDataSourceColumns()&&(r=n.getDataSourceColumnsOrderedByDataSource(),m=function(){var e,t,o;for(o=[],e=0,t=r.length;e<t;e++)a=r[e],o.push(a.dataSource.getRowValues(a.dataSourceColumns));return o}(),0!==m.length&&0!==m[0].length)){for(p=m[0].length,y=[],O=s=0,h=p;0<=h?s<h:s>h;O=0<=h?++s:--s){for(g={},e=d=0,C=m.length;0<=C?d<C:d>C;e=0<=C?++d:--d)for(S=m[e],b=c=0,w=r[e].dataSourceColumns.length;0<=w?c<w:c>w;b=0<=w?++c:--c)t=r[e].dataSourceColumns[b],g[t.getId()]=S[O][b];for(D=[],v=o.getDataSourceColumns(),l=0,i=v.length;l<i;l++)t=v[l],f=g[t.getId()],I="object"==typeof f?{v:f.value,f:f.display}:f,D.push(I);o.addDataRow(D),y.push(u.logRowAdded(D))}return y}},t.clearData=function(){var e;return o.clearData(),e={objectType:"data",content:o.getResourceTarget()},u.logClear(e)},t.exportData=function(){if(0!==o.getNrOfDataRows())return t.askQuestion.questionParams={question:"",answer:dataSet.getDisplayName(),okLabel:r.getI_Message("i_loadSave.saveDialog.download"),dialogBoxId:"askDataSetResourceName",questionOkAnswer:function(e){var t;return o.setDisplayName(e),t=o.getResourceBundle(),a.storeAsFile(t,e+".json"),o.emitModelLoaded(),u.logSave(t)}},t.dialogBoxes.askDataSetResourceName.show()},t.saveData=function(){if(0!==o.getNrOfDataRows())return t.askQuestion.questionParams={question:"",answer:o.getDisplayName(),okLabel:r.getI_Message("i_loadSave.saveDialog.save"),dialogBoxId:"askDataSetResourceName",questionOkAnswer:function(e){return o.setDisplayName(e),o.createResource(function(e,t){return e?alert("Failed to create resource:\n"+e):(o.emitModelLoaded(),u.logSaveAs(t))})}},t.dialogBoxes.askDataSetResourceName.show()},t.showDataSetModelJson=function(){return t.dataSetModelJson=JSON.stringify(o.getResourceContent(),null,"  "),t.dialogBoxes.showDataSetModelJsonDialogId.show()}},ut.tools.dataviewer.dataViewerTool.controller("dataCollectorCtrl",["$scope","dataSetModel","fileStorage","languageHandler",o])}).call(this);
//# sourceMappingURL=dataCollectorCtrl.js.map
