"use strict";var __extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},ut;!function(t){var e;!function(e){var a;!function(e){var a=t.commons.NamedEventArray,i=t.commons.ConfigurationModel;!function(t){t[t.Text=0]="Text",t[t.ConceptMap=1]="ConceptMap",t[t.Hypothesis=2]="Hypothesis",t[t.Question=3]="Question",t[t.DataGraph=4]="DataGraph",t[t.Observation=5]="Observation",t[t.Image=6]="Image",t[t.Table=7]="Table"}(e.ParagraphType||(e.ParagraphType={}));var o=e.ParagraphType,r={reportSectionConfigurations:[{id:"64cba293-ce47-4415-8d8d-8f294c3e0049asa11",created:"2015-08-20T15:37:55.528Z",lastModified:"2015-08-20T15:37:55.528Z",title:"Just for testing",explanation:"Some explanation for testing......."},{id:"64cba293-ce47-4415-8d8d-ererterter22",created:"2015-08-20T15:37:55.528Z",lastModified:"2015-08-20T15:37:55.528Z",title:"Just to have a second section",explanation:"Some explanation for the second section......."}],availabilityParagraphTypes:{Text:!0,Hypothesis:!0,Question:!0,DataGraph:!0,Observation:!0,Image:!0},autoSave:!1,singleDocumentMode:!1,showModelJson:!0,configUISettings:{showHideSections:{i_reportingTool_configuration_reportingTool:!0}}},n="\n   <ul>\n       <li>\n           help for the report tool....\n       </li>\n   </ul>\n   ",s={metadata:{actor:{objectType:"person",id:"unknown user@http://130.89.152.19:8080",displayName:"unknown user"},target:{objectType:"configuration",forApplication:"reportingTool",id:"70ad09b4-7dc0-4a82-d71a-62bbf30d10bfssf12",displayName:"initial configuration"},generator:{objectType:"application",url:"http://130.89.152.19:8080/golab/tools/phetSimWrapper/src/main/webapp/reportingTool.html",id:"ce6fc3d0-c48e-4929-f282-a77bb97dcc57tgdv12",displayName:"reporting tool"},provider:{objectType:"ils",url:"http://130.89.152.19:8080/golab/tools/phetSimWrapper/src/main/webapp/reportingTool.html",id:"http://130.89.152.19:8080",inquiryPhase:"unknown",inquiryPhaseId:null,inquiryPhaseName:null,displayName:"unknown"},published:"2014-09-30T08:15:08.148Z",id:"a0fee60f-7fc8-45c5-fccb-52616418d9cffsgsgrerdrte12"},content:r},p=function(){function e(e,a,i){this._reportingToolConfigurationModel=e,this._title=a,this._explanation=i,this._id=t.commons.utils.generateUUID(),this._createdMillis=Date.now(),this._created=new Date(this._createdMillis).toISOString(),this._lastModified=this._created}return e.createReportSectionConfigurationFromJson=function(t,a){var i=new e(t,"","");return i.loadFromJson(a),i},Object.defineProperty(e.prototype,"reportingToolConfigurationModel",{get:function(){return this._reportingToolConfigurationModel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.getId=function(){return this._id},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title!==t&&(this._title=t,this._reportingToolConfigurationModel.emitEvent("reportElementTitleChanged",[this.id,t]),this._reportingToolConfigurationModel.emitModelChanged())},enumerable:!0,configurable:!0}),e.prototype.getTitle=function(){return this._title},Object.defineProperty(e.prototype,"explanation",{get:function(){return this._explanation},set:function(t){this._explanation!==t&&(this._explanation=t,this._reportingToolConfigurationModel.emitEvent("reportElementExplanationChanged",[this.id,t]),this._reportingToolConfigurationModel.emitModelChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdMillis",{get:function(){return this._createdMillis},enumerable:!0,configurable:!0}),e.prototype.getCreatedMillis=function(){return this._createdMillis},Object.defineProperty(e.prototype,"created",{get:function(){return this._created},enumerable:!0,configurable:!0}),e.prototype.getCreated=function(){return this._created},Object.defineProperty(e.prototype,"lastModified",{get:function(){return this._lastModified},enumerable:!0,configurable:!0}),e.prototype.getLastModified=function(){return this._lastModified},e.prototype.getJson=function(){return{id:this.getId(),created:this.getCreated(),lastModified:this.getLastModified(),title:this.getTitle(),explanation:this.explanation}},e.prototype.getResource=function(){return this.getJson()},e.prototype.loadFromJson=function(t){this._id=t.id,this._created=t.created,this._createdMillis=new Date(this._created).getTime(),this._lastModified=t.lastModified,this._title=t.title,this._explanation=t.explanation},e}();e.ReportSectionConfiguration=p;var l=function(t){function e(e,a){t.call(this,e,a),this.reportingToolConfigurationModel=e}return __extends(e,t),e.prototype.getEventValue=function(t){return t.id},e.prototype.addNewName=function(){this.push(new p(this.reportingToolConfigurationModel,"",""))},e.prototype.getNameValue=function(t){return this.getValue(t).title},e.prototype.setNameValue=function(t,e){var a=this.getValue(t);a.title!==e&&(a.title=e,this.resourceEventEmitterModel.emitEvent(this.eventLabel+"ValueNameChanged",[t,e]),this.resourceEventEmitterModel.emitModelChanged())},e.prototype.getNameValues=function(t){return this.getValues(!1).map(function(t){return t.title})},e}(a),u=function(a){function i(e){var i=this;a.call(this,e,n),this._reportSectionConfigurations=new l(this,"reportSectionConfigurations"),this._availableParagraphTypes=[],this._availabilityParagraphTypes=[],this._useParagraphTypes=[],this._nonProductionParagraphTypes=[o.Image],this.concepts=new t.commons.NamedEventArray(this,"concepts"),this.relations=new t.commons.NamedEventArray(this,"relations"),this._availableParagraphTypes=t.commons.tsutils.enumToValues(o),golab.common.resourceLoader.isProductionVersion()&&(this._availableParagraphTypes=this._availableParagraphTypes.filter(function(t){return i._nonProductionParagraphTypes.indexOf(t)<0})),this._availableParagraphTypes.forEach(function(t){i._availabilityParagraphTypes[t]=!0}),this.updateUseParagraphTypes();var r=this.storageHandler.getMetadataHandler();switch(r.getContext()){case golab.ils.context.graasp:case golab.ils.context.ils:r.getILSStructure(function(t,e){t||(console.log(e),i.updateAvailableParagraphTypesFormIlsStructure(e))})}}return __extends(i,a),i.prototype.updateUseParagraphTypes=function(){var t=this;this._useParagraphTypes=this._availableParagraphTypes.filter(function(e){return t._availabilityParagraphTypes[e]})},i.prototype.updateAvailableParagraphTypesFormIlsStructure=function(t){var a=this,i=e.reportParagraphFactory.getToolInformations(),o=[],r=function(t){o.indexOf(t)<=0&&o.push(t)},n=function(t){for(var e=0,a=i;e<a.length;e++)for(var o=a[e],r=0,n=o.fileNames;r<n.length;r++){var s=n[r];if(t.indexOf("/"+s.toLowerCase()+".")>=0)return o.name}return null},s=function(t){for(var e=0,a=i;e<a.length;e++)for(var o=a[e],r=0,n=o.directoryNames;r<n.length;r++){var s=n[r];if(t.indexOf("/"+s.toLowerCase()+"/")>=0)return o.name}return null},p=function(t){var e=t.toLowerCase(),a=n(e);a||(a=s(e)),a&&r(a)},l=function(t){t.configuration?r(t.configuration.metadata.target.forApplication):p(t.url)},u=function(t){t.forEach(function(t){l(t)})},c=function(){var t=a._availableParagraphTypes.slice();a._availableParagraphTypes.length=0,t.forEach(function(t){var i=e.reportParagraphFactory.getToolInformation(t),r=!1;r=!i.name||o.indexOf(i.name)>=0,r&&a._availableParagraphTypes.push(t),a._availabilityParagraphTypes[t]=r})};u(t.apps),t.phases.forEach(function(t){u(t.apps)}),c(),this.updateUseParagraphTypes(),this.emitEvent("availabilityParagraphTypesChanged"),this.emitModelChanged()},Object.defineProperty(i.prototype,"availableParagraphTypes",{get:function(){return this._availableParagraphTypes},enumerable:!0,configurable:!0}),i.prototype.getParagraphTypeAvailable=function(t){return this._availabilityParagraphTypes[t]},i.prototype.setParagraphTypeAvailable=function(t,e){this._availabilityParagraphTypes[t]!==e&&(this._availabilityParagraphTypes[t]=e,this.updateUseParagraphTypes(),this.emitEvent("availabilityParagraphTypesChanged"),this.emitModelChanged())},Object.defineProperty(i.prototype,"paragraphTypes",{get:function(){return this._useParagraphTypes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reportSectionConfigurations",{get:function(){return this._reportSectionConfigurations},enumerable:!0,configurable:!0}),i.prototype.getReportSectionConfiguration=function(t){return this.reportSectionConfigurations.getValue(t)},i.prototype.loadDefaultConfiguration=function(){e.initialStandardConfiguration?this.loadFromResource(e.initialStandardConfiguration):this.loadFromResource(s)},i.prototype.getResourceContent=function(){var t=this,e=a.prototype.getResourceContent.call(this);return e.reportSectionConfigurations=this._reportSectionConfigurations.getValues().map(function(t){return t.getJson()}),e.availabilityParagraphTypes={},this._availableParagraphTypes.forEach(function(a){e.availabilityParagraphTypes[o[a]]=t._availabilityParagraphTypes[a]}),e},i.prototype.loadFromResourceContent=function(t){var e=this;a.prototype.loadFromResourceContent.call(this,t),this._reportSectionConfigurations.clear(),t.reportSectionConfigurations.forEach(function(t){var a=p.createReportSectionConfigurationFromJson(e,t);e._reportSectionConfigurations.push(a)}),t.availabilityParagraphTypes&&(this._availabilityParagraphTypes.length=0,this._availableParagraphTypes.forEach(function(a){e._availabilityParagraphTypes[a]=t.availabilityParagraphTypes[o[a]]}),this.updateUseParagraphTypes())},i.prototype.clearContent=function(){this._reportSectionConfigurations.clear(),a.prototype.clearContent.call(this)},i}(i);e.ReportToolConfigurationModel=u}(a=e.reportingtool||(e.reportingtool={}))}(e=t.tools||(t.tools={}))}(ut||(ut={}));
//# sourceMappingURL=reportToolConfigurationModel.js.map
