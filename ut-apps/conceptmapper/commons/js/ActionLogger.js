(function(){"use strict";var t,o,e=function(t,o){return function(){return t.apply(o,arguments)}};null==window.ut&&(window.ut={}),null==(t=window.ut).commons&&(t.commons={}),window.ut.commons.actionlogging=window.ut.commons.actionlogging||{},window.ut.commons.actionlogging.collideUrl="http://golab.collide.info/activity",o=!1,window.ut.commons.actionlogging.ActionLogger=function(){function t(t){this.log=e(this.log,this);var n;this._debug=o,this._debug&&(console.log("Initializing ActionLogger."),console.log("...setting default logging target: nullLogging."));try{t.getMetadata(),this.metadataHandler=t}catch(t){throw n=t,"ActionLogger needs a MetadataHandler at construction!"}this.loggingTarget=this.nullLogging,this.loggingUrl=null,this.loggedApplicationStarted=!1,this.logListeners=[]}return t.prototype.addLogListener=function(t){return this.logListeners.push(t)},t.prototype.removeLogListener=function(t){var o;if(o=this.logListeners.indexOf(t),o>=0)return this.logListeners.splice(o,1)},t.prototype.setLoggingTarget=function(t){return"string"==typeof t?(this._debug&&console.log("setLoggingTarget("+t+")"),this.loggingTarget=function(){switch(t.toLowerCase()){case"null":return this.nullLogging;case"console":return this.consoleLogging;case"consoleshort":return this.consoleLoggingShort;case"consoleobject":return this.consoleLoggingObject;case"dufftown":return this.loggingUrl=window.ut.commons.actionlogging.collideUrl,this.httpPostLogging;case"opensocial":return this.opensocialLogging;default:return this.loggingUrl=t,this.httpPostLogging}}.call(this)):this.loggingTarget=t},t.prototype.setLoggingTargetByName=function(t){return this._debug&&console.log("ActionLogger: setting logging target (by name) to "+t),"null"===t?this.loggingTarget=this.nullLogging:"console"===t?this.loggingTarget=this.consoleLogging:"consoleShort"===t?this.loggingTarget=this.consoleLoggingShort:"dufftown"===t?this.loggingTarget=this.dufftownLogging:"opensocial"===t?this.loggingTarget=this.opensocialLogging:(console.warn("ActionLogger: unknown logging target, setting to 'null'."),this.loggingTarget=this.nullLogging)},t.prototype.checkVerb=function(t){var o,e,n,i;e=!1,o=this.verbs;for(n in o)i=o[n],t===i&&(e=!0);if(!e)return console.warn("ActionLogger: unknown verb: "+t)},t.prototype.createActivityStreamObject=function(t,o){var e;return e={},e.published=(new Date).toISOString(),e.actor=this.metadataHandler.getActor(),e.verb=t,e.object=o,e.target=this.metadataHandler.getTarget(),e.generator=this.metadataHandler.getGenerator(),e.provider=this.metadataHandler.getProvider(),e},t.prototype.log=function(t,o,e){var n,i,r,g,s,a,c;null==e&&(e=!0),this.checkVerb(t),n={};try{n=this.createActivityStreamObject(t,o),this.loggingTarget(n,e)}catch(t){i=t,console.warn("something went wrong during logging:"),console.warn(i)}for(c=function(t){return t.logAction(n)},a=this.logListeners,r=0,g=a.length;r<g;r++)s=a[r],c(s);return n},t.prototype.nullLogging=function(t){},t.prototype.consoleLogging=function(t){return console.log(JSON.stringify(t,void 0,2))},t.prototype.getShortActionLogDescription=function(t){var o,e,n,i;return i=t.verb,e=t.object.objectType,o=t.object.id?t.object.id:"not specified",n=t.target.objectType,i+" - "+e+" of "+n+", id: "+o},t.prototype.consoleLoggingShort=function(t){return console.log("ActionLogger: "+this.getShortActionLogDescription(t))},t.prototype.consoleLoggingObject=function(t){return console.log("ActionLogger: "+this.getShortActionLogDescription(t)+", object:"),console.log(t.object)},t.prototype.opensocialLogging=function(t){var o,e;return void 0!==osapi?(o={userId:"@viewer",groupId:"@self",activity:t},e=this.getShortActionLogDescription(t),this._debug&&(console.log("ActionLogger: logging to Graasp: "+e+", logObject:"),console.log(o)),osapi.activitystreams.create(o).execute(function(t){return function(o){return void 0===o.id?(console.warn("ActionLogger: something went wrong when sending log action ("+e+") via osapi, response:"),console.warn(o)):t._debug?console.log("ActionLogger: sucessfully logged via osapi, response.id: "+o.id):void 0}}(this))):console.log("ActionLogger: can't log, osapi is undefined.")},t.prototype.httpPostLogging=function(t,o,e){var n;return null==o&&(o=!0),null==e&&(e=this.loggingUrl),n=this.getShortActionLogDescription(t),this._debug&&console.log("ActionLogger: logging to "+e+": "+n),$.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json",success:function(t){return function(o,e,n){if(t._debug)return console.log("POST actionlog success, response: "+o)}}(this),error:function(t){return function(t,o,e){return console.log("POST actionlog ("+n+") failed: "+t.status+" ("+t.statusText+"), response:"),console.log(JSON.stringify(t))}}(this)})},t.prototype.getDeviceInfo=function(){return{navigator:{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,geoLocation:navigator.geolocation,language:navigator.language,oscpu:navigator.oscpu,platform:navigator.platform,product:navigator.product,userAgent:navigator.userAgent},browser:head.browser,screen:head.screen,features:{mobile:head.mobile,desktop:head.desktop,touch:head.touch,portrait:head.portrait,landscape:head.landscape,retina:head.retina,transitions:head.transitions,transforms:head.transforms,gradients:head.gradients,multiplebgs:head.multiplebgs,boxshadow:head.boxshadow,borderimage:head.borderimage,borderradius:head.borderradius,cssreflections:head.cssreflections,fontface:head.fontface,rgba:head.rgba}}},t.prototype.logApplicationStarted=function(){var t,o,e;if(o=window.head||{},t=this.metadataHandler.getGenerator(),!this.loggedApplicationStarted)return e={id:t.id,objectType:"application",content:{device:this.getDeviceInfo()}},this.log(this.verbs.application_started,e),this.loggedApplicationStarted=!0},t.prototype.logAdd=function(t){return this.log(this.verbs.add,t)},t.prototype.logRemove=function(t){return this.log(this.verbs.remove,t)},t.prototype.logChange=function(t){return this.log(this.verbs.change,t)},t.prototype.logClear=function(t){return null==t&&(t=this.metadataHandler.getTarget()),this.log(this.verbs.clear,t)},t.prototype.logAccess=function(t){return this.log(this.verbs.access,t)},t.prototype.logStart=function(t){return this.log(this.verbs.start,t)},t.prototype.logCancel=function(t){return this.log(this.verbs.cancel,t)},t.prototype.logSend=function(t){return this.log(this.verbs.send,t)},t.prototype.logReceive=function(t){return this.log(this.verbs.receive,t)},t.prototype.logNew=function(t){return this._logStorageAction(this.verbs.new,t)},t.prototype.logLoad=function(t,o){return null==o&&(o=!0),this._logStorageAction(this.verbs.open,t,o)},t.prototype.logSaveAs=function(t){return this._logStorageAction(this.verbs.create,t)},t.prototype.logSave=function(t){return this._logStorageAction(this.verbs.update,t)},t.prototype.logDelete=function(t){return this._logStorageAction(this.verbs.delete,t)},t.prototype._logStorageAction=function(t,o,e){var n;return null==e&&(e=!0),n={objectType:"resource",content:o},o.metadata&&o.metadata.id&&(n.id=o.metadata.id),this.log(t,n,e)},t.prototype.verbs={add:"add",remove:"remove",change:"change",clear:"clear",access:"access",start:"start",cancel:"cancel",send:"send",receive:"receive",new:"new",open:"open",create:"create",update:"update",delete:"delete",application_started:"access",phase_changed:"access"},t}(),window.ut.commons.actionlogging.ActionLoggerWrapper=function(){function t(t){if(this.actionLogger=t,!(this.actionLogger instanceof window.ut.commons.actionlogging.ActionLogger))throw"the actionLogger parameter must be an instance of window.ut.commons.actionlogging.ActionLogger"}return t.prototype.setLoggingTarget=function(t){return this.actionLogger.setLoggingTarget(t)},t.prototype.getShortActionLogDescription=function(t){return this.actionLogger.getShortActionLogDescription(t)},t.prototype.logApplicationStarted=function(){return this.actionLogger.logApplicationStarted()},t.prototype.logAdd=function(t){return this.actionLogger.logAdd(t)},t.prototype.logRemove=function(t){return this.actionLogger.logRemove(t)},t.prototype.logChange=function(t){return this.actionLogger.logChange(t)},t.prototype.logClear=function(t){return this.actionLogger.logClear(t)},t.prototype.logAccess=function(t){return this.actionLogger.logAccess(t)},t.prototype.logStart=function(t){return this.actionLogger.logStart(t)},t.prototype.logCancel=function(t){return this.actionLogger.logCancel(t)},t.prototype.logSend=function(t){return this.actionLogger.logSend(t)},t.prototype.logReceive=function(t){return this.actionLogger.logReceive(t)},t.prototype.logNew=function(t){return this.actionLogger.logNew(t)},t.prototype.logLoad=function(t){return this.actionLogger.logLoad(t)},t.prototype.logSaveAs=function(t){return this.actionLogger.logSaveAs(t)},t.prototype.logSave=function(t){return this.actionLogger.logSave(t)},t.prototype.logDelete=function(t){return this.actionLogger.logDelete(t)},t.prototype.log=function(t,o){return this.actionLogger.log(t,o)},t}()}).call(this);
//# sourceMappingURL=ActionLogger.js.map
