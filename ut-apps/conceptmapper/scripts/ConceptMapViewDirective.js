(function(){"use strict";var t,e=function(t,e){return function(){return t.apply(e,arguments)}};window.ut=window.ut||{},window.ut.tools=window.ut.tools||{},window.ut.tools.conceptmapper=window.ut.tools.conceptmapper||{},t=function(t,e,o){return{restrict:"E",template:"",replace:!1,link:function(n,i,s){var r,l,a,c;return a=t,c=e,r=null,l=function(){var t;return r&&r.remove(),r=$("<div class='conceptMap'></div>"),i.append(r),t=new window.ut.tools.conceptmapper.ConceptMapperView(a,c,o,r),t.modelLoadedIntoView()},n.$watch("conceptMapModel",function(){return a=n.conceptMapModel,l()})}}},window.ut.tools.conceptmapper.ConceptMapAngularApp.directive("conceptMapView".toLowerCase(),["conceptMapModel","configurationModel","languageHandler",t]),window.ut.tools.conceptmapper.ConceptMapperView=function(){function t(t,o,n,i){this.conceptMapModel=t,this.configurationModel=o,this.languageHandler=n,this.root=i,this.modelLoadedIntoView=e(this.modelLoadedIntoView,this),this.shiftNodes=e(this.shiftNodes,this),this.deleteAllFromView=e(this.deleteAllFromView,this),this.changeConceptColorInView=e(this.changeConceptColorInView,this),this.addRelationToView=e(this.addRelationToView,this),this.bringToFront=e(this.bringToFront,this),this.addConceptToView=e(this.addConceptToView,this),this.initJsPlumb=e(this.initJsPlumb,this),this.getModel=e(this.getModel,this),this.debug=!1,this.model=this.conceptMapModel,this.model.addListener("contentCleared",this.deleteAllFromView),this.model.addListener("addConcept",this.addConceptToView),this.model.addListener("removeConcept",this.removeConceptFromView),this.model.addListener("changeConceptColor",this.changeConceptColorInView),this.model.addListener("addRelation",this.addRelationToView),this.model.addListener("modelLoaded",this.modelLoadedIntoView),this.model.addListener("contentLoaded",this.modelLoadedIntoView),this.colorClasses=["ut_tools_conceptmapper_blue","ut_tools_conceptmapper_yellow","ut_tools_conceptmapper_green","ut_tools_conceptmapper_red","ut_tools_conceptmapper_orange"],this.initJsPlumb()}return t.prototype.getModel=function(){return this.model},t.prototype.initJsPlumb=function(){var t;return t={Connector:["Straight"],ConnectorZIndex:0,DragOptions:{cursor:"pointer",zIndex:2e3},PaintStyle:{strokeStyle:"#92D6E3",lineWidth:2},EndpointStyle:{},Anchor:["Perimeter",{shape:"Ellipse"}],ConnectionOverlays:[["Label",{label:this.configurationModel.relations.getValue(0),location:.5,id:"label"}]],Detachable:!1,Reattach:!1},this.rootId=ut.commons.utils.generateUUID(),$(this.root[0]).attr("id",this.rootId),this.jsPlumbInstance=jsPlumb.getInstance({Container:this.rootId}),this.jsPlumbInstance.importDefaults(t),this.jsPlumbInstance.setRenderMode(jsPlumb.SVG)},t.prototype.addConceptToView=function(t){var e,o,n,i,s;switch(n=$("<div>"),n.attr("id",t.id+this.rootId),n.css("position","absolute"),n.css("top",t.y),n.css("left",t.x),n.addClass(t.type),n.addClass("ut_tools_conceptmapper_concept"),this.root.append(n),n.svg(),i=n.svg("get"),o="#4545AD",t.colorClass){case"ut_tools_conceptmapper_yellow":o="darkgoldenrod";break;case"ut_tools_conceptmapper_green":o="darkgreen";break;case"ut_tools_conceptmapper_red":o="red";break;case"ut_tools_conceptmapper_orange":o="darkorange"}return i.text(4,19,t.content,{fill:"white"}),s=$("svg > text",n)[0],e=s.getBBox(),i.rect(0,0,e.width+16,e.height+8,{fill:o}),n.css("width",e.width+18),n.css("height",e.height+10),$("svg",n).append(s)},t.prototype.bringToFront=function(t){var e;return e=$("#"+t),this.root.append(e)},t.prototype.addRelationToView=function(t){var e,o,n,i,s,r,l;return i=t.source+this.rootId,r=t.target+this.rootId,o=this.jsPlumbInstance.connect({source:i,target:r,cssClass:"connection"}),o.idPrefix="",o.id=t.id,null==t.content&&(t.content=" "),o.getOverlay("label").setLabel(""),o.addOverlay(["PlainArrow",{location:.85,width:10,height:8,id:"arrow"}]),o.getOverlay("label").addClass("ut_tools_conceptmapper_labelReadOnly"),n=$(o.getOverlay("label").getElement()),n.svg(),s=n.svg("get"),$(s.text(2,14,t.content,{fill:"white"})),l=$("svg > text",n)[0],e=l.getBBox(),s.rect(-e.width/2,0,1.6*e.width,e.height+2,{fill:"#ABAEFF"}),n.css("width",e.width+12),n.css("height",e.height+2),$("svg",n).append(l),this.jsPlumbInstance.repaintEverything()},t.prototype.changeConceptColorInView=function(t,e){var o,n,i,s,r;if(o=$("#"+t),null!=o){if(null!=e){for(r=this.colorClasses,n=0,i=r.length;n<i;n++)s=r[n],o.removeClass(s);return o.addClass(e)}return o.addClass("ut_tools_conceptmapper_blue")}},t.prototype.deleteAllFromView=function(){var t,e,o,n;for(n=this.jsPlumbInstance.getConnections(),e=0,o=n.length;e<o;e++)t=n[e],this.jsPlumbInstance.detach(t);return this.jsPlumbInstance.repaintEverything(),this.root.find(".ut_tools_conceptmapper_concept").each(function(t){return function(t,e){return $(e).remove()}}(this))},t.prototype.shiftNodes=function(){var t,e,o,n,i,s,r,l,a,c;for(r=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,s=0,a=this.model.getResourceContent().concepts,e=0,n=a.length;e<n;e++)t=a[e],t.x<r&&(r=t.x),t.y<l&&(l=t.y),t.y>s&&(s=t.y);for(c=this.model.getResourceContent().concepts,o=0,i=c.length;o<i;o++)t=c[o],t.x=t.x-r,t.y=t.y-l;return s-l},t.prototype.modelLoadedIntoView=function(){var t,e;return t=this.shiftNodes()+35,(e=function(o){return function(){var n,i,s,r,l,a,c,d,p,h,u;if(0===o.root[0].clientWidth)return setTimeout(e,100);for(o.deleteAllFromView(),d=o.model.getResourceContent().concepts,i=0,l=d.length;i<l;i++)n=d[i],o.addConceptToView(n);for(p=o.model.getResourceContent().relations,s=0,a=p.length;s<a;s++)u=p[s],o.addRelationToView(u);for(h=o.model.getResourceContent().concepts,r=0,c=h.length;r<c;r++)n=h[r],o.bringToFront(n.id);return o.jsPlumbInstance.repaintEverything(),$(o.root[0]).css("height",t),$(o.root[0]).css("min-height",t),$(o.root[0]).css("max-height",t)}}(this))()},t}()}).call(this);
//# sourceMappingURL=ConceptMapViewDirective.js.map
