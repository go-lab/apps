(function(){"use strict";var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var s in e)o.call(e,s)&&(t[s]=e[s]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;window.ut=window.ut||{},ut.commons=ut.commons||{},ut.tools=ut.tools||{},ut.tools.conclusions=ut.tools.conclusions||{},ut.tools.dataviewer=ut.tools.dataviewer||{},t={confidence:0,showConfidenceMeter:!0,inquiryPhaseName:""},ut.tools.conclusions.StatementConclusionModel=function(){function t(t,n,o){this.environmentHandlers=o,this.getId=e(this.getId,this),this.setStatement=e(this.setStatement,this),this.getStatement=e(this.getStatement,this),this.conclusionModel=t,this.statement=n,this.datas=[],this.selectedDataIndex=-1,this.newConfidence=this.getHypothesisConfidence(),this.argumentation=""}return t.prototype.getJson=function(){var t,e;return{id:this.getId(),datas:function(){var n,o,s,i;for(s=this.datas,i=[],n=0,o=s.length;n<o;n++)t=s[n],e=t.getResource(),e.content&&e.content.orderKey&&delete e.content.orderKey,i.push(e);return i}.call(this),selectedDataIndex:this.selectedDataIndex,newConfidence:this.newConfidence,argumentation:this.argumentation}},t.prototype.loadFromJson=function(t){var e,n,o,s,i,a,r;for(this.datas=[],r=t.datas,o=0,s=r.length;o<s;o++)switch(n=r[o],i="unknown",n.metadata&&n.metadata.target&&n.metadata.target.objectType&&(i=n.metadata.target.objectType),i){case"dataGraph":e=this.createDataGraph(),e.loadFromResource(n),this.datas.push(e);break;case"observation":a=this.createObservation(),a.loadFromJson(n),this.datas.push(a);break;default:console.warn("unknown object type: "+i)}return this.setSelectedDataIndex(t.selectedDataIndex),this.newConfidence=t.newConfidence,this.argumentation=t.argumentation},t.prototype.emitEvent=function(t,e){return this.conclusionModel.emitEvent(t,e)},t.prototype.emitModelChanged=function(){return this.conclusionModel.emitModelChanged()},t.prototype.getStatement=function(){return this.statement},t.prototype.setStatement=function(t){return this.statement=t},t.prototype.getId=function(){return this.statement.id},t.prototype.getHypothesisConfidence=function(){return this.statement.confidence?this.statement.confidence:0},t.prototype.getHypothesisConfidenceDefined=function(){return!!this.statement.showConfidenceMeter&&this.statement.showConfidenceMeter},t.prototype.createDataGraph=function(){var t,e;return e=new ut.tools.dataviewer.DataSet(this.environmentHandlers),t=new ut.tools.dataviewer.DataGraph(this.environmentHandlers,e)},t.prototype.createObservation=function(){var t;return t=new ut.tools.observationtool.Observation("","")},t.prototype.getDataForResourceId=function(t){var e,n,o,s;for(s=this.datas,n=0,o=s.length;n<o;n++)if(e=s[n],e.getId()===t)return e;return null},t.prototype.addDataGraphResource=function(t){var e;return e=this.getDataForResourceId(t.metadata.id),null===e&&(e=this.createDataGraph(),e.loadFromResource(t),this.datas.push(e),this.emitEvent("dataAdded",e),this.emitModelChanged()),e},t.prototype.addObservation=function(t){var e;return e=this.getDataForResourceId(t.id),null===e&&(e=t,this.datas.push(e),this.emitEvent("dataAdded",e),this.emitModelChanged()),e},t.prototype.deleteDataByIndex=function(t){var e,n;if(t>=0)return e=this.datas[t],this.datas.splice(t,1),this.emitEvent("dataRemoved",e),n=Math.min(t,this.datas.length-1),this.selectedDataIndex=n-1,this.setSelectedDataIndex(n),this.emitModelChanged()},t.prototype.deleteDataById=function(t){return this.deleteDataByIndex(this.getDataIndex(t))},t.prototype.getDatas=function(){return this.datas},t.prototype.getSelectedDataIndex=function(){return this.selectedDataIndex},t.prototype.setSelectedDataIndex=function(t){if(this.selectedDataIndex!==t)return this.selectedDataIndex=t,this.emitEvent("selectedDataIndexChanged",[this.selectedDataIndex]),this.emitModelChanged()},t.prototype.setSelectedData=function(t){return this.setSelectedDataIndex(this.getDataIndex(t.id))},t.prototype.getSelectedData=function(){return this.selectedDataIndex>=0?this.datas[this.selectedDataIndex]:null},t.prototype.getDataIndex=function(t){var e,n,o,s,i;for(o=0,i=this.datas,n=0,s=i.length;n<s;n++){if(e=i[n],e.id===t)return o;o++}return-1},t.prototype.setNewConfidence=function(t){if(this.newConfidence!==t)return this.newConfidence=t,this.emitEvent("newConfidenceChanged",[t]),this.emitModelChanged()},t.prototype.getNewConfidence=function(){return this.newConfidence},t.prototype.setArgumentation=function(t){if(this.argumentation!==t)return this.argumentation=t,this.emitEvent("argumentationChanged",[t]),this.emitModelChanged()},t.prototype.getArgumentation=function(){return this.argumentation},t}(),t={hypothesesModel:{},hypothesisConclusions:{},selectedHypothesisId:null,_debug:!1,phases:[],apps:[]},ut.tools.conclusions.ConclusionModel=function(t){function o(t,n){this.environmentHandlers=t,this.getStatement=e(this.getStatement,this),this.multiStatementsModelChanged=e(this.multiStatementsModelChanged,this),o.__super__.constructor.call(this,this.environmentHandlers,"conclusions"),this.actionLogger=new ut.tools.conclusions.ConclusionActionLogger(this.actionLogger),this.multiStatementsModel=n,this.loadedMultiStatementsModelJsonString=null,this.orderedStatementModels=[],this.selectedStatementId=-1,this.statement=null,this.statementConclusions=[],this.selectedStatementConclusion=null,this.multiStatementsModel.addListeners(["modelLoaded"],function(t){return function(){return t.multiStatementsModelChanged()}}(this))}return n(o,t),o.prototype.createNewModel=function(){var t;return t=this.multiStatementsModel.createNewModel(),new window.ut.tools.conclusions.ConclusionModel(this.environmentHandlers,t)},o.prototype.getConclusionActionLogger=function(){return this.actionLogger},o.prototype.applyLogLoad=function(t,e,n){switch(e){case"resources":return this.multiStatementsModel.applyLogLoad(t,e,n);default:return o.__super__.applyLogLoad.call(this,t,e,n)}},o.prototype.applyLogAdd=function(t,e){var n,o,s,i;switch(n=!1,t.object.objectType){case"observation":i=ut.tools.observationtool.createObservationFromJson(t.object.content.data),o=this.selectedStatementConclusion.addObservation(i),this.selectedStatementConclusion.setSelectedData(o);break;case"dataGraph":s=t.object.content.data,o=this.selectedStatementConclusion.addDataGraphResource(s),this.selectedStatementConclusion.setSelectedData(o);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(!n)return e(null)},o.prototype.applyLogChange=function(t,e){var n,s,i,a,r,d;switch(s=!1,t.object.objectType){case"selectedStatement":d=t.object.id,this.setSelectedStatementId(d);break;case"selectedData":a=t.object.id,r=this.selectedStatementConclusion.getDataIndex(a),this.selectedStatementConclusion.setSelectedDataIndex(r);break;case"argumentation":n=t.object.content.argumentation,this.selectedStatementConclusion.setArgumentation(n);break;case"confidence":i=t.object.content.confidence,this.selectedStatementConclusion.setNewConfidence(i);break;default:s=!0,o.__super__.applyLogChange.apply(this,arguments)}if(!s)return e(null)},o.prototype.applyLogRemove=function(t,e){var n,o;switch(n=!1,t.object.objectType){case"data":o=t.object.id,this.selectedStatementConclusion.deleteDataById(o);break;default:console.warn("Unknown object type: "+t.object.objectType)}if(!n)return e(null)},o.prototype.isEmpty=function(){return 0===this.statementConclusions.length},o.prototype.getResourceContent=function(){var t,e,n;return e=function(t){var e,n,o,s,i,a,r,d;if(t.content&&t.content.resources)for(a=t.content.resources,n=0,s=a.length;n<s;n++)if(d=a[n],Array.isArray(d.content))for(r=d.content,o=0,i=r.length;o<i;o++)e=r[o],delete e.orderKey;return t},o.__super__.getResourceContent.call(this,t),t=o.__super__.getResourceContent.call(this),t.multiStatementsModel=e(this.multiStatementsModel.getResource()),t.selectedStatementId=this.selectedStatementId,t.statementConclusions=function(){var t,e,o,s;for(o=this.statementConclusions,s=[],t=0,e=o.length;t<e;t++)n=o[t],s.push(n.getJson());return s}.call(this),t},o.prototype.loadLatestResource=function(t){return this.multiStatementsModel.isIlsStructureLoaded()?o.__super__.loadLatestResource.call(this,t):this.multiStatementsModel.addListener("ilsStructureChanged",function(e){return function(){return o.__super__.loadLatestResource.call(e,t)}}(this))},o.prototype.loadFromResourceContent=function(t){var e,n,s,i,a;return e=function(t){return function(e){var n,o,s,i,a,r,d,l,u;for(d=[],o=0,i=e.length;o<i;o++){for(u=e[o],l=null,r=t.statementConclusions,s=0,a=r.length;s<a;s++)n=r[s],n.getId()===u.id&&(l=n);l?d.push(l.loadFromJson(u)):d.push(void 0)}return d}}(this),o.__super__.loadFromResourceContent.call(this,t),this.clearStatementConclusions(),t.multiStatementsModel?this.multiStatementsModel.loadFromResource(t.multiStatementsModel):t.hypothesesModel?(n=this.multiStatementsModel.getResource(),s=[],s.push(t.hypothesesModel),n.content.resources=s,this.multiStatementsModel.loadFromResource(n)):this.multiStatementsModel.clear(),this.updateStatementConclusions(),a=[],t.statementConclusions?a=t.statementConclusions:t.hypothesisConclusions&&(a=t.hypothesisConclusions),e(a),i=null,t.selectedStatementId?i=t.selectedStatementId:t.selectedHypothesisId&&(i=t.selectedHypothesisId),this.setSelectedStatementId(i)},o.prototype.clearContent=function(){return this.multiStatementsModel.clear(),this.clearStatementConclusions(),this.loadedMultiStatementsModelJsonString=null,o.__super__.clearContent.call(this)},o.prototype.clearStatementConclusions=function(){return this.statementConclusions.splice(0),this.setSelectedStatementId(null),this.updateOrderedStatementsModels()},o.prototype.updateStatementConclusions=function(){var t,e,n,o,s,i,a,r,d,l;for(i=[],a=this.getStatements(),t=0,n=a.length;t<n;t++){for(d=a[t],s=null,r=this.statementConclusions,e=0,o=r.length;e<o;e++)l=r[e],d.id===l.getId()&&(s=l,s.setStatement(d));null===s&&(s=new ut.tools.conclusions.StatementConclusionModel(this,d,this.environmentHandlers)),i.push(s)}return this.statementConclusions=i},o.prototype.updateSelectedStatement=function(){var t,e,n,o,s;for(n=this.statementConclusions,t=0,e=n.length;t<e;t++)if(o=n[t],this.selectedStatementId===o.getId())return this.statement=o.getStatement(),void(this.selectedStatementConclusion=o);return s=this.statementConclusions.length>0?this.statementConclusions[0].getStatement():null,this.setSelectedStatement(s)},o.prototype.multiStatementsModelChanged=function(){var t;if(t=JSON.stringify(this.multiStatementsModel.getResource()),this.loadedMultiStatementsModelJsonString!==t)return this._debug&&console.log("loading new multi statements model..."),this.updateStatementConclusions(),this.updateSelectedStatement(),this.updateOrderedStatementsModels(),this.loadedMultiStatementsModelJsonString=t},o.prototype.getStatementsModelOrderKey=function(t){var e,n,o;return e="i_ils.tools",o=t.getMetadata().provider,n="unknown"!==o.inquiryPhaseName&&"undefined"!==o.inquiryPhaseName?o.inquiryPhaseName:this.multiStatementsModel.getIlsStructure()?e:o.displayName?o.displayName:e,n!==e?n.replace(/\./g,"_"):n},o.prototype.updateOrderedStatementsModelsWithoutIlsStructure=function(){var t,e,n,o,s,i,a,r,d;for(r={},s=this.getStatementsModels(),t=0,n=s.length;t<n;t++)a=s[t],o=this.getStatementsModelOrderKey(a),r[o]||(r[o]=[]),r[o].push(a);this.orderedStatementModels.splice(0,this.orderedStatementModels.length),i=[];for(e in r)d=r[e],i.push(this.orderedStatementModels.push(d));return i},o.prototype.updateOrderedStatementsModelsByIlsStructure=function(){var t,e,n,o,s,i,a,r,d,l,u,c;for(c={},d=this.getStatementsModels(),n=0,s=d.length;n<s;n++)u=d[n],e=u.getAppId(),c[e]=u;for(a=this.orderedStatementModels,a.splice(0,a.length),t=function(t){var e,n,o,s,i;for(i=[],n=0,o=t.length;n<o;n++)e=t[n],s=c[e.id],s&&i.push(s);if(i.length)return a.push(i)},l=this.multiStatementsModel.getIlsStructure().phases,o=0,i=l.length;o<i;o++)r=l[o],t(r.apps);return t(this.multiStatementsModel.getIlsStructure().apps)},o.prototype.updateOrderedStatementsModels=function(){return this.multiStatementsModel.getIlsStructure()?this.updateOrderedStatementsModelsByIlsStructure():this.updateOrderedStatementsModelsWithoutIlsStructure()},o.prototype.getOrderedStatementsModels=function(){return this.orderedStatementModels},o.prototype.getStatementsModels=function(){return this.multiStatementsModel.getResources()},o.prototype.getStatements=function(){var t,e,n,o,s,i,a,r,d;for(i=[],s=this.getStatementsModels(),t=0,n=s.length;t<n;t++){for(a=s[t],d=a instanceof window.ut.tools.hypothesis.HypothesesModel?a.getHypotheses():a instanceof window.ut.tools.questioning.QuestionsModel?a.getQuestions():(console.error("unexpected statements model type:"),console.error(a),[]),e=0,o=d.length;e<o;e++)r=d[e],r.orderKey=this.getStatementsModelOrderKey(a);i=i.concat(d)}return i},o.prototype.setSelectedStatement=function(t){return t?this.setSelectedStatementId(t.id):this.setSelectedStatementId(null)},o.prototype.setSelectedStatementId=function(t){var e,n,o,s,i,a,r,d,l;for(i=null,a=this.getStatements(),e=0,o=a.length;e<o;e++)d=a[e],d.id===t&&(i=d);if(this.statement!==i){for(this.statement=i,this.selectedStatementId=t,this.selectedStatementConclusion=null,r=this.statementConclusions,n=0,s=r.length;n<s;n++)l=r[n],l.getId()===t&&(this.selectedStatementConclusion=l);return this.emitEvent("selectedStatementChanged",this.statement),this.emitModelChanged()}},o.prototype.getSelectedStatementId=function(){return this.selectedStatementId},o.prototype.getStatement=function(){return this.statement},o.prototype.isStatementQuestion=function(){return!!this.statement&&!this.statement.elements},o.prototype.isStatementHypothesis=function(){return!!this.statement&&!!this.statement.elements},o.prototype.getHypothesisConfidence=function(){var t;return t=0,this.statement&&this.statement.confidence&&(t=this.statement.confidence),t},o.prototype.getSelectedStatementConclusion=function(){return this.selectedStatementConclusion},o}(ut.commons.ResourceEventEmitterModel)}).call(this);
//# sourceMappingURL=conclusionModel.js.map
