{"version":3,"sources":["view/legend.js"],"names":[],"mappings":"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","file":"view/legend.js","sourcesContent":["((activityStatistics) => {\n    const { scaleEquals } = activityStatistics.util;\n    const { PropTypes, createClass } = React;\n    const Legend = createClass({\n        displayName: 'Legend',\n        propTypes: {\n            scale: PropTypes.func.isRequired,\n            shape: PropTypes.oneOf([\n                'circle', 'cross', 'diamond', 'square', 'triangle-down',\n                'triangle-up',\n            ]),\n            highlightedItem: PropTypes.string,\n            highlightAction: PropTypes.func,\n            dehighlightAction: PropTypes.func,\n        },\n        getDefaultProps() {\n            return {\n                highlightedItem: '',\n                highlightAction: () => {},\n                dehighlightAction: () => {},\n            };\n        },\n        shouldComponentUpdate(nextProps) {\n            return !(\n                nextProps.shape === this.props.shape &&\n                nextProps.highlightedItem === this.props.highlightedItem &&\n                scaleEquals(nextProps.scale, this.props.scale)\n            );\n        },\n        render() {\n            return (\n                <svg width='100%' height='100' ref='svg' className='legend'>\n                    <g></g>\n                </svg>\n            );\n        },\n        update() {\n            const svg = d3.select(this.refs.svg);\n            const g = svg.select('g');\n            const { highlightedItem } = this.props;\n            let legend = d3.legend.color()\n            .scale(this.props.scale)\n            .shapePadding(5);\n            let padding = { x: 0, y: 0 };\n\n            if (this.props.shape) {\n                legend = legend.shape(\n                    'path',\n                    d3.svg.symbol().type(this.props.shape).size(100)()\n                );\n                padding = { x: 10, y: 5 };\n                g.attr('transform', `translate(${padding.x}, ${padding.y})`);\n            }\n\n            legend.on('cellclick', (item) => {\n                // this.getHighlightedItem is a workaround to this function not\n                // being rebound on update, so higlightedItem doesn't change\n                if (this.getHighlightedItem() !== item) {\n                    this.props.highlightAction(item);\n                } else {\n                    this.props.dehighlightAction();\n                }\n            });\n\n            g.call(legend);\n\n            g.selectAll('.cell').each(function(item) {\n                d3.select(this).classed('active', item === highlightedItem);\n            });\n\n            const dimensions = g[0][0].getBBox();\n            svg\n            .attr('width', dimensions.width + padding.x)\n            .attr('height', dimensions.height + padding.y);\n\n        },\n        getHighlightedItem() {\n            return this.props.highlightedItem;\n        },\n        componentDidMount() {\n            this.update();\n        },\n        componentDidUpdate() {\n            this.update();\n        },\n    });\n\n    activityStatistics.Legend = Legend;\n})(golab.tools.activityStatistics);\n"],"sourceRoot":"/source/"}