(function(){"use strict";var e,n,t,a,r,g,o,i,u,l,s,c,f,p,h,d,L,y,m,w,v=[].slice,b=function(e,n){function t(){this.constructor=e}for(var a in n)F.call(n,a)&&(e[a]=n[a]);return t.prototype=n.prototype,e.prototype=new t,e.__super__=n.prototype,e},F={}.hasOwnProperty,M=function(e,n){return function(){return e.apply(n,arguments)}};this.golab=this.golab||{},this.golab.common=this.golab.common||{},o=!0,o=!1,L=function(){var e,n;for(n=[],s=e=0;e<=10;s=++e)n.push(new RegExp("\\{"+s+"\\}","g"));return n}(),c="i_",m="???undefinedKey???",r="<![CDATA[",a="]]>",e=function(){function e(){this._debug=!1,this._getSpecialTranslation=null}return e.prototype.setSpecialTranslationFunction=function(e){return this._getSpecialTranslation=e},e.prototype.getMessage=function(){var e,n,t,a,r,g,o,i;if(r=arguments[0],n=2<=arguments.length?v.call(arguments,1):[],o="","undefined"!=typeof r)if("string"!=typeof r&&(r=r.toString()),i=null,this._getSpecialTranslation&&(i=this._getSpecialTranslation(r)),null===i&&(i=this.getMsg(r)),o=i,null!=o){for(t=a=0,g=n.length;a<g;t=++a)e=n[t],o=o.replace(L[t],e);o.match(L[t+1])&&console.log("g4i18n: missing argument(s) for key '"+r+"', value '"+i+"', but only "+(arguments.length-1)+" arguments given")}else console.log("g4i18n: missing value for key '"+r+"'"),o="???'"+r+"'???";else o=m;return o},e.prototype.getI_Message=function(){var e,n;return n=arguments[0],e=2<=arguments.length?v.call(arguments,1):[],"undefined"!=typeof n?("string"!=typeof n&&(n=n.toString()),0===n.toLowerCase().indexOf(c)?this.getMessage.apply(this,[n.substr(c.length)].concat(v.call(e))):n):m},e.prototype.getMsg=function(e){return console.error("this method must be overriden")},e.prototype.existsMessage=function(e){var n;return n=this.getMsg(e),"string"==typeof n&&n.length},e.prototype.getLanguage=function(){return console.error("this method must be overriden")},e}(),n=function(e){function n(){if(n.__super__.constructor.call(this),"undefined"==typeof gadgets||null===gadgets)throw"not running inside OpenSocial!";this.gadgetPrefs=new gadgets.Prefs,this._debug&&console.log("... running inside OpenSocial, gadgets.Prefs().getLang(): "+this.gadgetPrefs.getLang())}return b(n,e),n.prototype.getMsg=function(e){return this.gadgetPrefs.getMsg(e)},n.prototype.getLanguage=function(){return this.gadgetPrefs.getLang()},n}(e),h=function(e,n,t){var a;return a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.open("GET",e,!0),a.onload=function(e){return function(){if(4===a.readyState&&200===a.status)return n(a)}}(this),a.onreadystatechange=function(){if(4===a.readyState&&200!==a.status)return t(a)},a.send()},i=function(e,n,t){return"problems loading "+t+" file "+n+", error: "+e.status+" ("+e.statusText+")"},p="/languages/",f="list.txt",y=null,d="",golab.common.resourceLoader&&(y=golab.common.resourceLoader,d=y.getToolCommonsPathCacheControlPostFix()),u=function(e){var n;return n=""+p+e,y?y.getIncludeUrl(n):"."+n+d},l=function(e){var n,t;return t=e.indexOf(r),t>=0?(n=e.indexOf(a),e.substring(t+r.length,n)):e},t=function(e){function n(e,n){this.setLanguage=M(this.setLanguage,this),this.selectInitialLanguage=M(this.selectInitialLanguage,this),this.languageMap={},this.fallBackLanguage=null,this.fallBackLanguageMap={},this.languageFiles={},this.currentLanguage=null,arguments.length>0&&this.loadLanguageFileIndex(function(t){return function(){return t.selectInitialLanguage(e,n)}}(this),function(e){return function(t){return console.error(t),n(null,e)}}(this))}return b(n,e),n.prototype.loadLanguageFileIndex=function(e,n){var t;return t=u(f),h(t,function(n){return function(t){return n.parseIndexFileContent(t.responseText,e)}}(this),function(e){return n(i(e,t,"index"))})},n.prototype.parseIndexFileContent=function(e,n){var t,a,r,g,o,i;for(i=e.split("\n"),t=0,g=i.length;t<g;t++)o=i[t],o.trim().length&&o.trim()!==f&&(r=o.split("_"),r.length>=2?(a=r[r.length-2],this.languageFiles[a]=o.trim(),this.fallBackLanguage||(this.fallBackLanguage=a)):console.error("can't understand language file name "+o));return 0===this.languageFiles.length?console.error("could not find any language files in the language index file"):this.languageFiles.en||console.error("there is no en_*.xml file in the language index file"),this._debug&&console.log("found language files: "+JSON.stringify(this.languageFiles)),n()},n.prototype.getCurrentLanguage=function(){return this.currentLanguage},n.prototype.getLanguages=function(){var e,n,t,a;t=this.languageFiles,a=[];for(n in t)e=t[n],a.push(n);return a},n.prototype.selectInitialLanguage=function(e,n){return 0===this.languageFiles.length?(this.languageMap={},setTimeout(n,0)):this.setLanguage("en",function(t){return function(a,r){var g;return a?n(a,null):(t.fallBackLanguageMap=JSON.parse(JSON.stringify(t.languageMap)),g=t.getSimpleLanguage(e),t.getCurrentLanguage()!==g?t.setLanguage(e,n):n(a,r))}}(this))},n.prototype.setLanguage=function(e,n){var t,a;if(a=this.getSimpleLanguage(e),this.currentLanguage!==a){if(t=this.getLanguageFileName(a),!t){if(this.currentLanguage)return console.log("desired language '"+e+"' is not present, using 'en'"),void n(null,this);a="en",t=this.getLanguageFileName(a)}return this.loadLanguageFile(t,a,n)}},n.prototype.getLanguageFileName=function(e){return this.languageFiles[e]},n.prototype.getSimpleLanguage=function(e){var n;return n=e.split("-"),n[0]},n.prototype.loadLanguageFile=function(e,n,t){var a;return a=u(e),h(a,function(e){return function(r){return e.parseLanguageFileContent(r.responseText,a,n),e.currentLanguage=n,t(null,e)}}(this),function(e){return t(i(e,a,"language"))})},n.prototype.parseLanguageFileContent=function(e,n,t){var a,r,g,o,i,u,s,c,f,p,h,d,L,y,m,w;for(this.languageMap={},c=12345,f=0,y="<msg ",h='name="',o='"',u=">",r="</msg>",L=e.indexOf(y);L>=0&&--c>=0;)p=e.indexOf(h,L+y.length),p<0?(console.warn("failed to find name attribute"),L=-1):(d=p+h.length,g=e.indexOf(o,d),g<0?(console.warn("failed to find end of name attribute"),L=-1):(s=e.slice(d,g).trim(),i=e.indexOf(u,g+o.length),i<0?(console.warn("failed to find end op open msg tag"),L=-1):(m=i+u.length,a=e.indexOf(r,m),a<0?(console.warn("failed to find close msg tag"),L=-1):(w=e.slice(m,a).trim(),w=l(w),this.languageMap[s]=w,++f,L=e.indexOf(y,a+r.length)))));if(c<0&&console.warn("loop terminated because of to many loops, probable there is an error some where"),this._debug)return console.log("loaded "+f+" keys from language file "+n+", for language "+t)},n.prototype.getMsg=function(e){return this.languageMap.hasOwnProperty(e)?this.languageMap[e]:this.fallBackLanguageMap[e]},n.prototype.getLanguage=function(){return this.currentLanguage},n.prototype.getFallBackLanguage=function(){return this.fallBackLanguage},n.prototype.getNrOfLanguageFiles=function(){var e,n,t,a;n=0,t=this.languageFiles;for(e in t)a=t[e],++n;return n},n.prototype.getLanguageFile=function(e){},n.prototype.getNrOfKeys=function(){var e,n,t,a;n=0,t=this.languageMap;for(e in t)a=t[e],++n;return n},n}(e),window.golab.testing=window.golab.testing||{},window.golab.testing.languagehandlers={handleCData:l,StandAloneLanguageHandler:t},g=null,w=[],window.golab.createLanguageHandler=function(e,a){var r,i;return i=function(e,n){var t,r;for(o&&console.log("new language handler created, nr of waiting callbacks: "+w.length),g={error:e,languageHandler:n},t=0,r=w.length;t<r;t++)(a=w[t])(e,n);return w.length=0},r=function(){return"undefined"!=typeof gadgets&&null!==gadgets?setTimeout(function(){return o&&console.log("creating OpenSocialLanguageHandler"),i(null,new n)},0):(o&&console.log("creating StandAloneLanguageHandler for language: "+e),new t(e,i))},g?setTimeout(function(){return o&&console.log("using already created languageHandler"),a(g.error,g.languageHandler)},0):(0===w.length&&r(),w.push(a))}}).call(this);
//# sourceMappingURL=languageHandlers.js.map
